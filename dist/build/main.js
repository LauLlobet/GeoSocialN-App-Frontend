//     Underscore.js 1.8.2
//     http://underscorejs.org
//     (c) 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.

/*!
 * @overview RSVP - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/tildeio/rsvp.js/master/LICENSE
 * @version   3.0.18
 */

/*!
	 * @overview es6-promise - a tiny implementation of Promises/A+.
	 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
	 * @license   Licensed under MIT license
	 *            See https://raw.githubusercontent.com/jakearchibald/es6-promise/master/LICENSE
	 * @version   2.1.1
	 */

(function(){function E(e){function t(t,n,r,i,s,o){for(;s>=0&&s<o;s+=e){var u=i?i[s]:s;r=n(r,t[u],u,t)}return r}return function(n,r,i,s){r=v(r,s,4);var o=!w(n)&&d.keys(n),u=(o||n).length,a=e>0?0:u-1;return arguments.length<3&&(i=n[o?o[a]:a],a+=e),t(n,r,i,o,a,u)}}function T(e){return function(t,n,r){n=m(n,r);var i=t!=null&&t.length,s=e>0?0:i-1;for(;s>=0&&s<i;s+=e)if(n(t[s],s,t))return s;return-1}}function L(e,t){var n=k.length,i=e.constructor,s=d.isFunction(i)&&i.prototype||r,o="constructor";d.has(e,o)&&!d.contains(t,o)&&t.push(o);while(n--)o=k[n],o in e&&e[o]!==s[o]&&!d.contains(t,o)&&t.push(o)}var e=this,t=e._,n=Array.prototype,r=Object.prototype,i=Function.prototype,s=n.push,o=n.slice,u=r.toString,a=r.hasOwnProperty,f=Array.isArray,l=Object.keys,c=i.bind,h=Object.create,p=function(){},d=function(e){if(e instanceof d)return e;if(!(this instanceof d))return new d(e);this._wrapped=e};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=d),exports._=d):e._=d,d.VERSION="1.8.2";var v=function(e,t,n){if(t===void 0)return e;switch(n==null?3:n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,s){return e.call(t,n,r,i,s)}}return function(){return e.apply(t,arguments)}},m=function(e,t,n){return e==null?d.identity:d.isFunction(e)?v(e,t,n):d.isObject(e)?d.matcher(e):d.property(e)};d.iteratee=function(e,t){return m(e,t,Infinity)};var g=function(e,t){return function(n){var r=arguments.length;if(r<2||n==null)return n;for(var i=1;i<r;i++){var s=arguments[i],o=e(s),u=o.length;for(var a=0;a<u;a++){var f=o[a];if(!t||n[f]===void 0)n[f]=s[f]}}return n}},y=function(e){if(!d.isObject(e))return{};if(h)return h(e);p.prototype=e;var t=new p;return p.prototype=null,t},b=Math.pow(2,53)-1,w=function(e){var t=e&&e.length;return typeof t=="number"&&t>=0&&t<=b};d.each=d.forEach=function(e,t,n){t=v(t,n);var r,i;if(w(e))for(r=0,i=e.length;r<i;r++)t(e[r],r,e);else{var s=d.keys(e);for(r=0,i=s.length;r<i;r++)t(e[s[r]],s[r],e)}return e},d.map=d.collect=function(e,t,n){t=m(t,n);var r=!w(e)&&d.keys(e),i=(r||e).length,s=Array(i);for(var o=0;o<i;o++){var u=r?r[o]:o;s[o]=t(e[u],u,e)}return s},d.reduce=d.foldl=d.inject=E(1),d.reduceRight=d.foldr=E(-1),d.find=d.detect=function(e,t,n){var r;w(e)?r=d.findIndex(e,t,n):r=d.findKey(e,t,n);if(r!==void 0&&r!==-1)return e[r]},d.filter=d.select=function(e,t,n){var r=[];return t=m(t,n),d.each(e,function(e,n,i){t(e,n,i)&&r.push(e)}),r},d.reject=function(e,t,n){return d.filter(e,d.negate(m(t)),n)},d.every=d.all=function(e,t,n){t=m(t,n);var r=!w(e)&&d.keys(e),i=(r||e).length;for(var s=0;s<i;s++){var o=r?r[s]:s;if(!t(e[o],o,e))return!1}return!0},d.some=d.any=function(e,t,n){t=m(t,n);var r=!w(e)&&d.keys(e),i=(r||e).length;for(var s=0;s<i;s++){var o=r?r[s]:s;if(t(e[o],o,e))return!0}return!1},d.contains=d.includes=d.include=function(e,t,n){return w(e)||(e=d.values(e)),d.indexOf(e,t,typeof n=="number"&&n)>=0},d.invoke=function(e,t){var n=o.call(arguments,2),r=d.isFunction(t);return d.map(e,function(e){var i=r?t:e[t];return i==null?i:i.apply(e,n)})},d.pluck=function(e,t){return d.map(e,d.property(t))},d.where=function(e,t){return d.filter(e,d.matcher(t))},d.findWhere=function(e,t){return d.find(e,d.matcher(t))},d.max=function(e,t,n){var r=-Infinity,i=-Infinity,s,o;if(t==null&&e!=null){e=w(e)?e:d.values(e);for(var u=0,a=e.length;u<a;u++)s=e[u],s>r&&(r=s)}else t=m(t,n),d.each(e,function(e,n,s){o=t(e,n,s);if(o>i||o===-Infinity&&r===-Infinity)r=e,i=o});return r},d.min=function(e,t,n){var r=Infinity,i=Infinity,s,o;if(t==null&&e!=null){e=w(e)?e:d.values(e);for(var u=0,a=e.length;u<a;u++)s=e[u],s<r&&(r=s)}else t=m(t,n),d.each(e,function(e,n,s){o=t(e,n,s);if(o<i||o===Infinity&&r===Infinity)r=e,i=o});return r},d.shuffle=function(e){var t=w(e)?e:d.values(e),n=t.length,r=Array(n);for(var i=0,s;i<n;i++)s=d.random(0,i),s!==i&&(r[i]=r[s]),r[s]=t[i];return r},d.sample=function(e,t,n){return t==null||n?(w(e)||(e=d.values(e)),e[d.random(e.length-1)]):d.shuffle(e).slice(0,Math.max(0,t))},d.sortBy=function(e,t,n){return t=m(t,n),d.pluck(d.map(e,function(e,n,r){return{value:e,index:n,criteria:t(e,n,r)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index-t.index}),"value")};var S=function(e){return function(t,n,r){var i={};return n=m(n,r),d.each(t,function(r,s){var o=n(r,s,t);e(i,r,o)}),i}};d.groupBy=S(function(e,t,n){d.has(e,n)?e[n].push(t):e[n]=[t]}),d.indexBy=S(function(e,t,n){e[n]=t}),d.countBy=S(function(e,t,n){d.has(e,n)?e[n]++:e[n]=1}),d.toArray=function(e){return e?d.isArray(e)?o.call(e):w(e)?d.map(e,d.identity):d.values(e):[]},d.size=function(e){return e==null?0:w(e)?e.length:d.keys(e).length},d.partition=function(e,t,n){t=m(t,n);var r=[],i=[];return d.each(e,function(e,n,s){(t(e,n,s)?r:i).push(e)}),[r,i]},d.first=d.head=d.take=function(e,t,n){return e==null?void 0:t==null||n?e[0]:d.initial(e,e.length-t)},d.initial=function(e,t,n){return o.call(e,0,Math.max(0,e.length-(t==null||n?1:t)))},d.last=function(e,t,n){return e==null?void 0:t==null||n?e[e.length-1]:d.rest(e,Math.max(0,e.length-t))},d.rest=d.tail=d.drop=function(e,t,n){return o.call(e,t==null||n?1:t)},d.compact=function(e){return d.filter(e,d.identity)};var x=function(e,t,n,r){var i=[],s=0;for(var o=r||0,u=e&&e.length;o<u;o++){var a=e[o];if(w(a)&&(d.isArray(a)||d.isArguments(a))){t||(a=x(a,t,n));var f=0,l=a.length;i.length+=l;while(f<l)i[s++]=a[f++]}else n||(i[s++]=a)}return i};d.flatten=function(e,t){return x(e,t,!1)},d.without=function(e){return d.difference(e,o.call(arguments,1))},d.uniq=d.unique=function(e,t,n,r){if(e==null)return[];d.isBoolean(t)||(r=n,n=t,t=!1),n!=null&&(n=m(n,r));var i=[],s=[];for(var o=0,u=e.length;o<u;o++){var a=e[o],f=n?n(a,o,e):a;t?((!o||s!==f)&&i.push(a),s=f):n?d.contains(s,f)||(s.push(f),i.push(a)):d.contains(i,a)||i.push(a)}return i},d.union=function(){return d.uniq(x(arguments,!0,!0))},d.intersection=function(e){if(e==null)return[];var t=[],n=arguments.length;for(var r=0,i=e.length;r<i;r++){var s=e[r];if(d.contains(t,s))continue;for(var o=1;o<n;o++)if(!d.contains(arguments[o],s))break;o===n&&t.push(s)}return t},d.difference=function(e){var t=x(arguments,!0,!0,1);return d.filter(e,function(e){return!d.contains(t,e)})},d.zip=function(){return d.unzip(arguments)},d.unzip=function(e){var t=e&&d.max(e,"length").length||0,n=Array(t);for(var r=0;r<t;r++)n[r]=d.pluck(e,r);return n},d.object=function(e,t){var n={};for(var r=0,i=e&&e.length;r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},d.indexOf=function(e,t,n){var r=0,i=e&&e.length;if(typeof n=="number")r=n<0?Math.max(0,i+n):n;else if(n&&i)return r=d.sortedIndex(e,t),e[r]===t?r:-1;if(t!==t)return d.findIndex(o.call(e,r),d.isNaN);for(;r<i;r++)if(e[r]===t)return r;return-1},d.lastIndexOf=function(e,t,n){var r=e?e.length:0;typeof n=="number"&&(r=n<0?r+n+1:Math.min(r,n+1));if(t!==t)return d.findLastIndex(o.call(e,0,r),d.isNaN);while(--r>=0)if(e[r]===t)return r;return-1},d.findIndex=T(1),d.findLastIndex=T(-1),d.sortedIndex=function(e,t,n,r){n=m(n,r,1);var i=n(t),s=0,o=e.length;while(s<o){var u=Math.floor((s+o)/2);n(e[u])<i?s=u+1:o=u}return s},d.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=n||1;var r=Math.max(Math.ceil((t-e)/n),0),i=Array(r);for(var s=0;s<r;s++,e+=n)i[s]=e;return i};var N=function(e,t,n,r,i){if(r instanceof t){var s=y(e.prototype),o=e.apply(s,i);return d.isObject(o)?o:s}return e.apply(n,i)};d.bind=function(e,t){if(c&&e.bind===c)return c.apply(e,o.call(arguments,1));if(!d.isFunction(e))throw new TypeError("Bind must be called on a function");var n=o.call(arguments,2),r=function(){return N(e,r,t,this,n.concat(o.call(arguments)))};return r},d.partial=function(e){var t=o.call(arguments,1),n=function(){var r=0,i=t.length,s=Array(i);for(var o=0;o<i;o++)s[o]=t[o]===d?arguments[r++]:t[o];while(r<arguments.length)s.push(arguments[r++]);return N(e,n,this,this,s)};return n},d.bindAll=function(e){var t,n=arguments.length,r;if(n<=1)throw new Error("bindAll must be passed function names");for(t=1;t<n;t++)r=arguments[t],e[r]=d.bind(e[r],e);return e},d.memoize=function(e,t){var n=function(r){var i=n.cache,s=""+(t?t.apply(this,arguments):r);return d.has(i,s)||(i[s]=e.apply(this,arguments)),i[s]};return n.cache={},n},d.delay=function(e,t){var n=o.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},d.defer=d.partial(d.delay,d,1),d.throttle=function(e,t,n){var r,i,s,o=null,u=0;n||(n={});var a=function(){u=n.leading===!1?0:d.now(),o=null,s=e.apply(r,i),o||(r=i=null)};return function(){var f=d.now();!u&&n.leading===!1&&(u=f);var l=t-(f-u);return r=this,i=arguments,l<=0||l>t?(o&&(clearTimeout(o),o=null),u=f,s=e.apply(r,i),o||(r=i=null)):!o&&n.trailing!==!1&&(o=setTimeout(a,l)),s}},d.debounce=function(e,t,n){var r,i,s,o,u,a=function(){var f=d.now()-o;f<t&&f>=0?r=setTimeout(a,t-f):(r=null,n||(u=e.apply(s,i),r||(s=i=null)))};return function(){s=this,i=arguments,o=d.now();var f=n&&!r;return r||(r=setTimeout(a,t)),f&&(u=e.apply(s,i),s=i=null),u}},d.wrap=function(e,t){return d.partial(t,e)},d.negate=function(e){return function(){return!e.apply(this,arguments)}},d.compose=function(){var e=arguments,t=e.length-1;return function(){var n=t,r=e[t].apply(this,arguments);while(n--)r=e[n].call(this,r);return r}},d.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},d.before=function(e,t){var n;return function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=null),n}},d.once=d.partial(d.before,2);var C=!{toString:null}.propertyIsEnumerable("toString"),k=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];d.keys=function(e){if(!d.isObject(e))return[];if(l)return l(e);var t=[];for(var n in e)d.has(e,n)&&t.push(n);return C&&L(e,t),t},d.allKeys=function(e){if(!d.isObject(e))return[];var t=[];for(var n in e)t.push(n);return C&&L(e,t),t},d.values=function(e){var t=d.keys(e),n=t.length,r=Array(n);for(var i=0;i<n;i++)r[i]=e[t[i]];return r},d.mapObject=function(e,t,n){t=m(t,n);var r=d.keys(e),i=r.length,s={},o;for(var u=0;u<i;u++)o=r[u],s[o]=t(e[o],o,e);return s},d.pairs=function(e){var t=d.keys(e),n=t.length,r=Array(n);for(var i=0;i<n;i++)r[i]=[t[i],e[t[i]]];return r},d.invert=function(e){var t={},n=d.keys(e);for(var r=0,i=n.length;r<i;r++)t[e[n[r]]]=n[r];return t},d.functions=d.methods=function(e){var t=[];for(var n in e)d.isFunction(e[n])&&t.push(n);return t.sort()},d.extend=g(d.allKeys),d.extendOwn=d.assign=g(d.keys),d.findKey=function(e,t,n){t=m(t,n);var r=d.keys(e),i;for(var s=0,o=r.length;s<o;s++){i=r[s];if(t(e[i],i,e))return i}},d.pick=function(e,t,n){var r={},i=e,s,o;if(i==null)return r;d.isFunction(t)?(o=d.allKeys(i),s=v(t,n)):(o=x(arguments,!1,!1,1),s=function(e,t,n){return t in n},i=Object(i));for(var u=0,a=o.length;u<a;u++){var f=o[u],l=i[f];s(l,f,i)&&(r[f]=l)}return r},d.omit=function(e,t,n){if(d.isFunction(t))t=d.negate(t);else{var r=d.map(x(arguments,!1,!1,1),String);t=function(e,t){return!d.contains(r,t)}}return d.pick(e,t,n)},d.defaults=g(d.allKeys,!0),d.clone=function(e){return d.isObject(e)?d.isArray(e)?e.slice():d.extend({},e):e},d.tap=function(e,t){return t(e),e},d.isMatch=function(e,t){var n=d.keys(t),r=n.length;if(e==null)return!r;var i=Object(e);for(var s=0;s<r;s++){var o=n[s];if(t[o]!==i[o]||!(o in i))return!1}return!0};var A=function(e,t,n,r){if(e===t)return e!==0||1/e===1/t;if(e==null||t==null)return e===t;e instanceof d&&(e=e._wrapped),t instanceof d&&(t=t._wrapped);var i=u.call(e);if(i!==u.call(t))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":if(+e!==+e)return+t!==+t;return+e===0?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t}var s=i==="[object Array]";if(!s){if(typeof e!="object"||typeof t!="object")return!1;var o=e.constructor,a=t.constructor;if(o!==a&&!(d.isFunction(o)&&o instanceof o&&d.isFunction(a)&&a instanceof a)&&"constructor"in e&&"constructor"in t)return!1}n=n||[],r=r||[];var f=n.length;while(f--)if(n[f]===e)return r[f]===t;n.push(e),r.push(t);if(s){f=e.length;if(f!==t.length)return!1;while(f--)if(!A(e[f],t[f],n,r))return!1}else{var l=d.keys(e),c;f=l.length;if(d.keys(t).length!==f)return!1;while(f--){c=l[f];if(!d.has(t,c)||!A(e[c],t[c],n,r))return!1}}return n.pop(),r.pop(),!0};d.isEqual=function(e,t){return A(e,t)},d.isEmpty=function(e){return e==null?!0:w(e)&&(d.isArray(e)||d.isString(e)||d.isArguments(e))?e.length===0:d.keys(e).length===0},d.isElement=function(e){return!!e&&e.nodeType===1},d.isArray=f||function(e){return u.call(e)==="[object Array]"},d.isObject=function(e){var t=typeof e;return t==="function"||t==="object"&&!!e},d.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(e){d["is"+e]=function(t){return u.call(t)==="[object "+e+"]"}}),d.isArguments(arguments)||(d.isArguments=function(e){return d.has(e,"callee")}),typeof /./!="function"&&typeof Int8Array!="object"&&(d.isFunction=function(e){return typeof e=="function"||!1}),d.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},d.isNaN=function(e){return d.isNumber(e)&&e!==+e},d.isBoolean=function(e){return e===!0||e===!1||u.call(e)==="[object Boolean]"},d.isNull=function(e){return e===null},d.isUndefined=function(e){return e===void 0},d.has=function(e,t){return e!=null&&a.call(e,t)},d.noConflict=function(){return e._=t,this},d.identity=function(e){return e},d.constant=function(e){return function(){return e}},d.noop=function(){},d.property=function(e){return function(t){return t==null?void 0:t[e]}},d.propertyOf=function(e){return e==null?function(){}:function(t){return e[t]}},d.matcher=d.matches=function(e){return e=d.extendOwn({},e),function(t){return d.isMatch(t,e)}},d.times=function(e,t,n){var r=Array(Math.max(0,e));t=v(t,n,1);for(var i=0;i<e;i++)r[i]=t(i);return r},d.random=function(e,t){return t==null&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},d.now=Date.now||function(){return(new Date).getTime()};var O={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},M=d.invert(O),_=function(e){var t=function(t){return e[t]},n="(?:"+d.keys(e).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(e){return e=e==null?"":""+e,r.test(e)?e.replace(i,t):e}};d.escape=_(O),d.unescape=_(M),d.result=function(e,t,n){var r=e==null?void 0:e[t];return r===void 0&&(r=n),d.isFunction(r)?r.call(e):r};var D=0;d.uniqueId=function(e){var t=++D+"";return e?e+t:t},d.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var P=/(.)^/,H={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},B=/\\|'|\r|\n|\u2028|\u2029/g,j=function(e){return"\\"+H[e]};d.template=function(e,t,n){!t&&n&&(t=n),t=d.defaults({},t,d.templateSettings);var r=RegExp([(t.escape||P).source,(t.interpolate||P).source,(t.evaluate||P).source].join("|")+"|$","g"),i=0,s="__p+='";e.replace(r,function(t,n,r,o,u){return s+=e.slice(i,u).replace(B,j),i=u+t.length,n?s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?s+="'+\n((__t=("+r+"))==null?'':__t)+\n'":o&&(s+="';\n"+o+"\n__p+='"),t}),s+="';\n",t.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{var o=new Function(t.variable||"obj","_",s)}catch(u){throw u.source=s,u}var a=function(e){return o.call(this,e,d)},f=t.variable||"obj";return a.source="function("+f+"){\n"+s+"}",a},d.chain=function(e){var t=d(e);return t._chain=!0,t};var F=function(e,t){return e._chain?d(t).chain():t};d.mixin=function(e){d.each(d.functions(e),function(t){var n=d[t]=e[t];d.prototype[t]=function(){var e=[this._wrapped];return s.apply(e,arguments),F(this,n.apply(d,e))}})},d.mixin(d),d.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=n[e];d.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e==="shift"||e==="splice")&&n.length===0&&delete n[0],F(this,n)}}),d.each(["concat","join","slice"],function(e){var t=n[e];d.prototype[e]=function(){return F(this,t.apply(this._wrapped,arguments))}}),d.prototype.value=function(){return this._wrapped},d.prototype.valueOf=d.prototype.toJSON=d.prototype.value,d.prototype.toString=function(){return""+this._wrapped},typeof define=="function"&&define.amd&&define("underscore",[],function(){return d})}).call(this),define("lib/underscore",function(){}),define("scenes/WriteButton",[],function(){"use strict";return{x:20,y:900,hw:165}}),define("scenes/ForestSwipeRight",["./WriteButton"],function(e){"use strict";var t=1e3,n=2;return{title:"ForestSwipeLeft",lengthInTime:t,trees:[{initialPosition:"3r",nocreate:!1,x:616,y:-439,w:196*n,h:354,text:"%initial",type:"real",tween:{startColor:16711680,endColor:255,x:310,y:-386,w:260*n,t:t},finalPosition:"2r",newTree:!1,button:e},{initialPosition:"3c",nocreate:!1,x:-41,y:-441,w:198*n,h:356,text:"%initial",type:"real",tween:{startColor:16711680,endColor:255,x:-548,y:-386,w:260*n,t:t},finalPosition:"2l",newTree:!1,button:e},{initialPosition:"2r",nocreate:!1,x:310,y:-386,w:260*n,h:464,text:"%initial",type:"real",tween:{startColor:16711680,endColor:255,x:-237,y:-324,w:497*n,t:t},finalPosition:"1c",newTree:!1,button:e},{initialPosition:"2l",nocreate:!1,x:-548,y:-386,w:260*n,h:464,text:"%initial",type:"real",tween:{startColor:16711680,endColor:255,x:-1878,y:-329,w:497*n,t:t},finalPosition:"delete",newTree:!1,button:e},{initialPosition:"1c",nocreate:!1,x:-237,y:-324,w:497*n,h:893,text:"%initial",type:"real",tween:{startColor:16711680,endColor:255,x:-1871,y:-729,w:1411*n,t:t},finalPosition:"delete",newTree:!1,button:e},{initialPosition:"0l",nocreate:!0,x:516,y:-729,w:1411*n,h:893,text:"%initial",type:"real",tween:{startColor:16711680,endColor:255,x:826,y:-3729,w:7011*n,t:t},finalPosition:"delete",newTree:!1,button:e}]}}),define("scenes/ForestSwipeLeft",["./WriteButton"],function(e){"use strict";var t=1e3,n=2;return{title:"ForestSwipeLeft",lengthInTime:t,trees:[{initialPosition:"3l",nocreate:!1,x:-695,y:-441,w:196*n,h:356,text:"%initial",type:"real",tween:{startColor:16711680,endColor:255,x:-548,y:-386,w:259*n,t:t},finalPosition:"2l",newTree:!1,button:e},{initialPosition:"3c",nocreate:!1,x:-41,y:-441,w:198*n,h:357,text:"%initial",type:"real",tween:{startColor:16711680,endColor:255,x:310,y:-386,w:259*n,t:t},finalPosition:"2r",newTree:!1,button:e},{initialPosition:"2r",nocreate:!1,x:310,y:-368,w:260*n,h:464,text:"%initial",type:"real",tween:{startColor:16711680,endColor:255,x:1406,y:-326,w:497*n,t:t},finalPosition:"delete",newTree:!1,button:e},{initialPosition:"2l",nocreate:!1,x:-548,y:-386,w:260*n,h:464,text:"%initial",type:"real",tween:{startColor:16711680,endColor:255,x:-237,y:-324,w:497*n,t:t},finalPosition:"1c",newTree:!1,button:e},{initialPosition:"1c",nocreate:!1,x:-237,y:-324,w:497*n,h:893,text:"%initial",type:"real",tween:{startColor:16711680,endColor:255,x:516,y:-729,w:1411*n,t:t},finalPosition:"0l",newTree:!1,button:e},{initialPosition:"0l",nocreate:!0,x:466,y:-729,w:1411*n,h:893,text:"%initial",type:"real",tween:{startColor:16711680,endColor:255,x:2066,y:-2129,w:4811*n,t:t},finalPosition:"delete",newTree:!1,button:e}]}}),function(){"use strict";function e(e){return typeof e=="function"||typeof e=="object"&&e!==null}function t(e){return typeof e=="function"}function n(e){return typeof e=="object"&&e!==null}function o(){}function a(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}function f(e){var t=e._promiseCallbacks;return t||(t=e._promiseCallbacks={}),t}function h(e,t){if(e==="onerror"){c.on("error",t);return}if(arguments.length!==2)return c[e];c[e]=t}function d(){setTimeout(function(){var e;for(var t=0;t<p.length;t++){e=p[t];var n=e.payload;n.guid=n.key+n.id,n.childGuid=n.key+n.childId,n.error&&(n.stack=n.error.stack),c.trigger(e.name,e.payload)}p.length=0},50)}function v(e,t,n){1===p.push({name:e,payload:{key:t._guidKey,id:t._id,eventName:e,detail:t._result,childId:n&&n._id,label:t._label,timeStamp:s(),error:c["instrument-with-stack"]?new Error(t._label):null}})&&d()}function g(){return new TypeError("A promises callback cannot return that same promise.")}function y(){}function x(e){try{return e.then}catch(t){return S.error=t,S}}function T(e,t,n,r){try{e.call(t,n,r)}catch(i){return i}}function N(e,t,n){c.async(function(e){var r=!1,i=T(n,t,function(n){if(r)return;r=!0,t!==n?L(e,n):O(e,n)},function(t){if(r)return;r=!0,M(e,t)},"Settle: "+(e._label||" unknown promise"));!r&&i&&(r=!0,M(e,i))},e)}function C(e,t){t._state===w?O(e,t._result):t._state===E?(t._onError=null,M(e,t._result)):_(t,undefined,function(n){t!==n?L(e,n):O(e,n)},function(t){M(e,t)})}function k(e,n){if(n.constructor===e.constructor)C(e,n);else{var r=x(n);r===S?M(e,S.error):r===undefined?O(e,n):t(r)?N(e,n,r):O(e,n)}}function L(t,n){t===n?O(t,n):e(n)?k(t,n):O(t,n)}function A(e){e._onError&&e._onError(e._result),D(e)}function O(e,t){if(e._state!==b)return;e._result=t,e._state=w,e._subscribers.length===0?c.instrument&&m("fulfilled",e):c.async(D,e)}function M(e,t){if(e._state!==b)return;e._state=E,e._result=t,c.async(A,e)}function _(e,t,n,r){var i=e._subscribers,s=i.length;e._onError=null,i[s]=t,i[s+w]=n,i[s+E]=r,s===0&&e._state&&c.async(D,e)}function D(e){var t=e._subscribers,n=e._state;c.instrument&&m(n===w?"fulfilled":"rejected",e);if(t.length===0)return;var r,i,s=e._result;for(var o=0;o<t.length;o+=3)r=t[o],i=t[o+n],r?j(n,r,i,s):i(s);e._subscribers.length=0}function P(){this.error=null}function B(e,t){try{return e(t)}catch(n){return H.error=n,H}}function j(e,n,r,i){var s=t(r),o,u,a,f;if(s){o=B(r,i),o===H?(f=!0,u=o.error,o=null):a=!0;if(n===o){M(n,g());return}}else o=i,a=!0;n._state===b&&(s&&a?L(n,o):f?M(n,u):e===w?O(n,o):e===E&&M(n,o))}function F(e,t){var n=!1;try{t(function(r){if(n)return;n=!0,L(e,r)},function(r){if(n)return;n=!0,M(e,r)})}catch(r){M(e,r)}}function I(e,t,n){return e===w?{state:"fulfilled",value:n}:{state:"rejected",reason:n}}function q(e,t,n,r){var i=this;i._instanceConstructor=e,i.promise=new e(y,r),i._abortOnReject=n,i._validateInput(t)?(i._input=t,i.length=t.length,i._remaining=t.length,i._init(),i.length===0?O(i.promise,i._result):(i.length=i.length||0,i._enumerate(),i._remaining===0&&O(i.promise,i._result))):M(i.promise,i._validationError())}function U(e,t){return(new R(this,e,!0,t)).promise}function W(e,t){function o(e){L(r,e)}function u(e){M(r,e)}var n=this,r=new n(y,t);if(!i(e))return M(r,new TypeError("You must pass an array to race.")),r;var s=e.length;for(var a=0;r._state===b&&a<s;a++)_(n.resolve(e[a]),undefined,o,u);return r}function V(e,t){var n=this;if(e&&typeof e=="object"&&e.constructor===n)return e;var r=new n(y,t);return L(r,e),r}function J(e,t){var n=this,r=new n(y,t);return M(r,e),r}function Y(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function Z(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function et(e,n){var r=this;r._id=G++,r._label=n,r._state=undefined,r._result=undefined,r._subscribers=[],c.instrument&&m("created",r),y!==e&&(t(e)||Y(),r instanceof et||Z(),F(r,e))}function nt(e,t,n){this._superConstructor(e,t,!1,n)}function rt(e,t){return(new nt(tt,e,t)).promise}function st(e,t){return tt.all(e,t)}function lt(e,t){St[ut]=e,St[ut+1]=t,ut+=2,ut===2&&Nt()}function gt(){var e=process.nextTick,t=process.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);return Array.isArray(t)&&t[1]==="0"&&t[2]==="10"&&(e=setImmediate),function(){e(xt)}}function yt(){return function(){ft(xt)}}function bt(){var e=0,t=new dt(xt),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function wt(){var e=new MessageChannel;return e.port1.onmessage=xt,function(){e.port2.postMessage(0)}}function Et(){return function(){setTimeout(xt,1)}}function xt(){for(var e=0;e<ut;e+=2){var t=St[e],n=St[e+1];t(n),St[e]=undefined,St[e+1]=undefined}ut=0}function Tt(){try{var e=require,t=e("vertx");return ft=t.runOnLoop||t.runOnContext,yt()}catch(n){return Et()}}function Ct(e){var t={};return t.promise=new tt(function(e,n){t.resolve=e,t.reject=n},e),t}function Lt(e,n,r){return tt.all(e,r).then(function(e){if(!t(n))throw new TypeError("You must pass a function as filter's second argument.");var i=e.length,s=new Array(i);for(var o=0;o<i;o++)s[o]=n(e[o]);return tt.all(s,r).then(function(t){var n=new Array(i),r=0;for(var s=0;s<i;s++)t[s]&&(n[r]=e[s],r++);return n.length=r,n})})}function Ot(e,t,n){this._superConstructor(e,t,!0,n)}function _t(e,t,n){this._superConstructor(e,t,!1,n)}function Dt(e,t){return(new _t(tt,e,t)).promise}function Ht(e,t){return(new Mt(tt,e,t)).promise}function jt(e,n,r){return tt.all(e,r).then(function(e){if(!t(n))throw new TypeError("You must pass a function as map's second argument.");var i=e.length,s=new Array(i);for(var o=0;o<i;o++)s[o]=n(e[o]);return tt.all(s,r)})}function It(){this.value=undefined}function Ut(e){try{return e.then}catch(t){return qt.value=t,qt}}function zt(e,t,n){try{e.apply(t,n)}catch(r){return qt.value=r,qt}}function Wt(e,t){var n={},r,i,s=e.length,o=new Array(s);for(var u=0;u<s;u++)o[u]=e[u];for(i=0;i<t.length;i++)r=t[i],n[r]=o[i+1];return n}function Xt(e){var t=e.length,n=new Array(t-1);for(var r=1;r<t;r++)n[r-1]=e[r];return n}function Vt(e,t){return{then:function(n,r){return e.call(t,n,r)}}}function $t(e,t){var n=function(){var n=this,r=arguments.length,s=new Array(r+1),o,u=!1;for(var a=0;a<r;++a){o=arguments[a];if(!u){u=Gt(o);if(u===Rt){var f=new tt(y);return M(f,Rt.value),f}u&&u!==!0&&(o=Vt(u,o))}s[a]=o}var l=new tt(y);return s[r]=function(e,n){e?M(l,e):t===undefined?L(l,n):t===!0?L(l,Xt(arguments)):i(t)?L(l,Wt(arguments,t)):L(l,n)},u?Qt(l,s,e,n):Kt(l,s,e,n)};return n.__proto__=e,n}function Kt(e,t,n,r){var i=zt(n,r,t);return i===qt&&M(e,i.value),e}function Qt(e,t,n,r){return tt.all(t).then(function(t){var i=zt(n,r,t);return i===qt&&M(e,i.value),e})}function Gt(e){return e&&typeof e=="object"?e.constructor===tt?!0:Ut(e):!1}function en(e,t){return tt.race(e,t)}function nn(e,t){return tt.reject(e,t)}function sn(e,t){return tt.resolve(e,t)}function un(e){throw setTimeout(function(){throw e}),e}function ln(e,t){c.async(e,t)}function cn(){c.on.apply(c,arguments)}function hn(){c.off.apply(c,arguments)}var r;Array.isArray?r=Array.isArray:r=function(e){return Object.prototype.toString.call(e)==="[object Array]"};var i=r,s=Date.now||function(){return(new Date).getTime()},u=Object.create||function(e){if(arguments.length>1)throw new Error("Second argument not supported");if(typeof e!="object")throw new TypeError("Argument must be an object");return o.prototype=e,new o},l={mixin:function(e){return e.on=this.on,e.off=this.off,e.trigger=this.trigger,e._promiseCallbacks=undefined,e},on:function(e,t){var n=f(this),r;r=n[e],r||(r=n[e]=[]),a(r,t)===-1&&r.push(t)},off:function(e,t){var n=f(this),r,i;if(!t){n[e]=[];return}r=n[e],i=a(r,t),i!==-1&&r.splice(i,1)},trigger:function(e,t){var n=f(this),r,i;if(r=n[e])for(var s=0;s<r.length;s++)i=r[s],i(t)}},c={instrument:!1};l.mixin(c);var p=[],m=v,b=void 0,w=1,E=2,S=new P,H=new P,R=q;q.prototype._validateInput=function(e){return i(e)},q.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},q.prototype._init=function(){this._result=new Array(this.length)},q.prototype._enumerate=function(){var e=this,t=e.length,n=e.promise,r=e._input;for(var i=0;n._state===b&&i<t;i++)e._eachEntry(r[i],i)},q.prototype._eachEntry=function(e,t){var r=this,i=r._instanceConstructor;n(e)?e.constructor===i&&e._state!==b?(e._onError=null,r._settledAt(e._state,t,e._result)):r._willSettleAt(i.resolve(e),t):(r._remaining--,r._result[t]=r._makeResult(w,t,e))},q.prototype._settledAt=function(e,t,n){var r=this,i=r.promise;i._state===b&&(r._remaining--,r._abortOnReject&&e===E?M(i,n):r._result[t]=r._makeResult(e,t,n)),r._remaining===0&&O(i,r._result)},q.prototype._makeResult=function(e,t,n){return n},q.prototype._willSettleAt=function(e,t){var n=this;_(e,undefined,function(e){n._settledAt(w,t,e)},function(e){n._settledAt(E,t,e)})};var z=U,X=W,$=V,K=J,Q="rsvp_"+s()+"-",G=0,tt=et;et.cast=$,et.all=z,et.race=X,et.resolve=$,et.reject=K,et.prototype={constructor:et,_guidKey:Q,_onError:function(e){c.async(function(t){setTimeout(function(){t._onError&&c.trigger("error",e)},0)},this)},then:function(e,t,n){var r=this,i=r._state;if(i===w&&!e||i===E&&!t)return c.instrument&&m("chained",r,r),r;r._onError=null;var s=new r.constructor(y,n),o=r._result;c.instrument&&m("chained",r,s);if(i){var u=arguments[i-1];c.async(function(){j(i,s,u,o)})}else _(r,s,e,t);return s},"catch":function(e,t){return this.then(undefined,e,t)},"finally":function(e,t){var n=this,r=n.constructor;return n.then(function(t){return r.resolve(e()).then(function(){return t})},function(t){return r.resolve(e()).then(function(){throw t})},t)}},nt.prototype=u(R.prototype),nt.prototype._superConstructor=R,nt.prototype._makeResult=I,nt.prototype._validationError=function(){return new Error("allSettled must be called with an array")};var it=rt,ot=st,ut=0,at={}.toString,ft,ct=lt,ht=typeof window!="undefined"?window:undefined,pt=ht||{},dt=pt.MutationObserver||pt.WebKitMutationObserver,vt=typeof process!="undefined"&&{}.toString.call(process)==="[object process]",mt=typeof Uint8ClampedArray!="undefined"&&typeof importScripts!="undefined"&&typeof MessageChannel!="undefined",St=new Array(1e3),Nt;vt?Nt=gt():dt?Nt=bt():mt?Nt=wt():ht===undefined&&typeof require=="function"?Nt=Tt():Nt=Et();var kt=Ct,At=Lt,Mt=Ot;Ot.prototype=u(R.prototype),Ot.prototype._superConstructor=R,Ot.prototype._init=function(){this._result={}},Ot.prototype._validateInput=function(e){return e&&typeof e=="object"},Ot.prototype._validationError=function(){return new Error("Promise.hash must be called with an object")},Ot.prototype._enumerate=function(){var e=this,t=e.promise,n=e._input,r=[];for(var i in n)t._state===b&&Object.prototype.hasOwnProperty.call(n,i)&&r.push({position:i,entry:n[i]});var s=r.length;e._remaining=s;var o;for(var u=0;t._state===b&&u<s;u++)o=r[u],e._eachEntry(o.entry,o.position)},_t.prototype=u(Mt.prototype),_t.prototype._superConstructor=R,_t.prototype._makeResult=I,_t.prototype._validationError=function(){return new Error("hashSettled must be called with an object")};var Pt=Dt,Bt=Ht,Ft=jt,qt=new It,Rt=new It,Jt=$t,Yt;if(typeof self=="object")Yt=self;else{if(typeof global!="object")throw new Error("no global: `self` or `global` found");Yt=global}var Zt=Yt,tn=en,rn=nn,on=sn,an=un;c.async=ct;var fn=on;if(typeof window!="undefined"&&typeof window.__PROMISE_INSTRUMENTATION__=="object"){var pn=window.__PROMISE_INSTRUMENTATION__;h("instrument",!0);for(var dn in pn)pn.hasOwnProperty(dn)&&cn(dn,pn[dn])}var vn={race:tn,Promise:tt,allSettled:it,hash:Bt,hashSettled:Pt,denodeify:Jt,on:cn,off:hn,map:Ft,filter:At,resolve:on,reject:rn,all:ot,rethrow:an,defer:kt,EventTarget:l,configure:h,async:ln};typeof define=="function"&&define.amd?define("lib/rsvp",[],function(){return vn}):typeof module!="undefined"&&module.exports?module.exports=vn:typeof Zt!="undefined"&&(Zt.RSVP=vn)}.call(this),define("View/SceneLoaderLevel/StackOfScenes",["../../lib/underscore","../../lib/rsvp"],function(e,t){"use strict";function n(e){this.sceneLoaderInterface=e,this.stackedScenesArray=[],this.alreadyPlaying=!1}return n.prototype.stackLoadScene=function(t,n){this.stackedScenesArray.push({sceneType:t,texts:n})},n.prototype.playAllStackedScenes=function(){return this.deferred=t.defer(),this.stackedScenesArray.length>0&&!this.alreadyPlaying?(this.alreadyPlaying=!0,this.playItemOfScenesArray(this),this.deferred.promise):this.deferred.promise},n.prototype.playItemOfScenesArray=function r(e){var t;if(e.stackedScenesArray.length===0){e.alreadyPlaying=!1,t=e.sceneLoaderInterface.getTreeAlreadyDisplayed(),e.deferred.resolve(t);return}var n=e.stackedScenesArray.shift();e.sceneLoaderInterface.loadScene(n.sceneType,n.texts,e,r)},n}),define("View/SceneLoaderLevel/SceneLoader",["../../lib/underscore","../../scenes/ForestSwipeRight","../../scenes/ForestSwipeLeft","./StackOfScenes"],function(e,t,n,r){"use strict";function i(e,t){this.idCounter=0,this.spriteManagerPhaserApiInterface=e,this.sceneObjectsTable=[],this.stackOfScenes=new r(this),this.initial=!0,this.newlyPresentedTreeSubjectNotifier=t,this.heigthOfUnplantedTree=1700}return i.prototype.stackLoadScene=function(t,n){this.stackOfScenes.stackLoadScene(t,n)},i.prototype.playAllStackedScenes=function(){return this.stackOfScenes.playAllStackedScenes()},i.prototype.loadScene=function(t,n,r,i){this.cleanToDelete();var s=this.loadSceneFromScenes(t),o=0;return _.each(s.trees,function(e){if(e.initialPosition.charAt(0)==="3"||this.initial===!0&&e.text==="%initial")n[o]!==null&&n[o]!==undefined&&n[o].id!==-1?(e.text=n[o].text,typeof n[o].id!="undefined"&&(e.treeid=n[o].id,e.metersToHide=n[o].metersToHide),o+=1):n[o]===undefined?(e.text=undefined,e.treeid=undefined,o+=1):n[o]===null&&(e.text=null,e.treeid=null,o+=1)},this),this.initial=!1,_.each(s.trees,function(e){if(e.nocreate===!0&&this.findIndexOfOldTreeWithFinalPosition(e.initialPosition)<0)return;this.bindTreeAndTweenToTable(e),e.treeid===null&&e.text===null&&(e.y-=this.heigthOfUnplantedTree,e.tween.y-=this.heigthOfUnplantedTree)},this),this.setAllToOld(),this.spriteManagerPhaserApiInterface.tellAllActiveSpritesSoItCanUpdateIt(this.getAllActiveIds()),this.newlyPresentedTreeSubjectNotifier.newlyPresentedTree(this.getTreeAlreadyDisplayed()),this.callCallbackAfterTween(r,i,s.lengthInTime)},i.prototype.callCallbackAfterTween=function(t,n,r){n!==undefined&&setTimeout(function(){n(t)},r)},i.prototype.bindTreeAndTweenToTable=function(t){var n;return n=this.createTableEntry(t),this.deleteIfExistSameFinalPostionEntryAndCopyHisTextAndType(t.initialPosition,n),this.sceneObjectsTable.push(n),this.idCounter},i.prototype.setAllToOld=function(){_.each(this.sceneObjectsTable,function(e){e.isOld=!0},this)},i.prototype.getTreeFromId=function(t){var n=_.filter(this.sceneObjectsTable,function(e){return e.id===t});return n[0].tree},i.prototype.getAllActiveIds=function(){var t=[],n;for(n=0;n<this.sceneObjectsTable.length;n++)t.push(this.sceneObjectsTable[n].id);return t},i.prototype.createTableEntry=function(t){return this.idCounter+=1,{tree:t,finalPosition:t.finalPosition,initialPosition:t.initialPosition,id:this.idCounter}},i.prototype.deleteIfExistSameFinalPostionEntryAndCopyHisTextAndType=function(t,n){var r,i=this.findIndexOfOldTreeWithFinalPosition(t);r=this.sceneObjectsTable[i],i>=0&&(this.sceneObjectsTable.splice(i,1),this.copyValuesFromOldTreeToNewOne(r,n))},i.prototype.copyValuesFromOldTreeToNewOne=function(t,n){n.tree.text=t.tree.text,n.tree.type=t.tree.type,n.tree.unburiedLayersTreeLevel=t.tree.unburiedLayersTreeLevel,n.tree.treeid=t.tree.treeid;if(typeof t.tree.treeid!="undefined"||t.tree.treeid!==null)n.tree.metersToHide=t.tree.metersToHide},i.prototype.findIndexOfOldTreeWithFinalPosition=function(t){var n;for(n=0;n<this.sceneObjectsTable.length;n+=1)if(this.sceneObjectsTable[n].finalPosition===t&&this.sceneObjectsTable[n].isOld===!0)return n;return-1},i.prototype.findIndexOfTreeWithFinalPosition=function(t){var n;for(n=0;n<this.sceneObjectsTable.length;n+=1)if(this.sceneObjectsTable[n].finalPosition===t)return n;return-1},i.prototype.getTreeWithFinalPosition=function(t){var n=this.findIndexOfTreeWithFinalPosition(t);return n>=0?this.sceneObjectsTable[n]:null},i.prototype.getTreeDiscardedWhenSwipeLeft=function(){var t=this.getTreeWithFinalPosition("2r");return t.tree.treeid},i.prototype.getTreeDiscardedWhenSwipeRight=function(){return this.getTreeWithFinalPosition("2l").tree.treeid},i.prototype.getTreeAlreadyDisplayed=function(){return this.getTreeWithFinalPosition("1c").tree.treeid},i.prototype.cleanToDelete=function(){this.sceneObjectsTable=_.filter(this.sceneObjectsTable,function(e){return e.finalPosition!=="delete"})},i.prototype.loadSceneFromScenes=function(r){return r==="forestSwipeRight"?JSON.parse(JSON.stringify(t)):JSON.parse(JSON.stringify(n))},i}),define("View/UIEngineView/TreeView/LinkSetterToTree",[],function(){"use strict";function t(){this.linklayers=[],this.createdLinkLayers=[]}var e="#";return t.prototype.setInteractiveLinksToRetroText=function(t,n,r,i){var s=1,o=s,u=0,a=9.85,f=21.5,l=1.6,c,h="",p=[],d=!1,v=[],m,g,y,b;for(m=0,g="";g=n.charAt(m);m+=1)g=n.charAt(m),g===e&&d===!1?d=!0:d&&g===" "&&(d=!1,this.linklayers.push(p),p=[],v.push(h),h=""),d&&(c=t.create(o,u,"linkLayer"),c.scale.x=c.scale.y=l,p.push(c),this.createdLinkLayers.push(c),g!=="#"&&(h+=g)),g==="\n"?(u+=f,o=s):o+=a;for(y=0;y<this.linklayers.length;y+=1)for(b=0;b<this.linklayers[y].length;b+=1)this.linklayers[y][b].inputEnabled=!0,this.linklayers[y][b].input.priorityID=1,this.linklayers[y][b].useHandCursor=!0,this.linklayers[y][b].events.onInputDown.add(function(){i.linkClicked(this.id)},{id:v[y],gestureObserver:i})},t.prototype.removeLinks=function(){var t;if(this.createdLinkLayers===undefined)return;for(t=0;t<this.createdLinkLayers.length;t+=1)this.createdLinkLayers[t].destroy()},t}),define("View/UIEngineView/TreeView/BurySetterToTree",[],function(){"use strict";function r(e,t,n){this.linklayers=[],this.leafs=undefined,this.lock=undefined,this.game=e,this.treeBuryGroup=t,this.gestureObserver=n}var e="*bury",t="*passwd:",n=16;return r.prototype.setUnburiedLayers=function(t){this.unburiedLayers=t},r.prototype.setEditing=function(t){this.editing=t},r.prototype.handleBuringTextCases=function(t){this.text=t,this.buryMessageInLayerOrderAccordingToFirstAppearance(),this.editing?this.setBuryLayersToAlpha():this.setBuryLayersToSolid()},r.prototype.buryMessageInLayerOrderAccordingToFirstAppearance=function(){var r=this.findLineOfCharacterInText(t),i=this.findLineOfCharacterInText(e);r>i?(this.buryMessageIfNecesary(),this.buryMessageLeafsIfNecesary()):(this.buryMessageLeafsIfNecesary(),this.buryMessageIfNecesary())},r.prototype.unBury=function(e,t){var n,r,i=e==="leafs"?this.leafs:this.lock;try{i!==undefined&&(n=this.game.add.tween(i).to({alpha:0},200,"Linear",!0,0,0),n.onComplete.add(function(){i!==undefined&&(i.alpha=0,i.destroy(),i=undefined)},this)),this.lockpick!==undefined&&e==="lock"&&(r=this.game.add.tween(this.lockpick).to({alpha:0},200,"Linear",!0,0,0),r.onComplete.add(function(){this.lockpick.destroy(),this.lockpick=undefined},this))}catch(s){alert(s.message),console.log(s.stack)}},r.prototype.buryMessageFromLine=function(e,t,n,r){var i=-10,s=21.5*t,o,u=1.3;o=e.create(i,s,n),o.scale.x=o.scale.y=u,n==="lock"&&this.setLockPick(e,o.x,o.y,o.scale.x),n==="leafs"?this.leafsLineY=s:this.leafsLineY=undefined,this[r]=o},r.prototype.getHeightOfLeafBuryLayer=function(){return this.leafsLineY},r.prototype.setBuryLayersToClickable=function(t){this.setSpriteToClickableOrNot(t,!0)},r.prototype.setBuryLayersToNotClickable=function(t){this.setSpriteToClickableOrNot(t,!1)},r.prototype.setSpriteToClickableOrNot=function(t,n){t.inputEnabled=n,n&&(t.input.priorityID=50)},r.prototype.setLockPick=function(e,t,n,r){var i=t+60,s=n+50,o;o=e.create(i,s,"lockpick"),o.scale.x=o.scale.y=r,o.inputEnabled=!0,o.input.priorityID=52,o.useHandCursor=!0,o.events.onInputDown.add(function(){this.gestureObserver.buriedLayerEvent(this.eventId)},{eventId:"lock",gestureObserver:this.gestureObserver}),this.lockpick=o},r.prototype.buryMessageLeafsIfNecesary=function(){var n=this.findLineOfCharacterInText(e);this.lineWithThatCharExistsOnText(n)&&this.hasntBeenUnburied("leafs")&&this.buryLayerNotAlreadyExists("leafs")&&this.buryMessageFromLine(this.treeBuryGroup,n,"leafs","leafs")},r.prototype.buryMessageIfNecesary=function(){var n=this.findLineOfCharacterInText(t);this.lineWithThatCharExistsOnText(n)&&this.hasntBeenUnburied("lock")&&this.buryLayerNotAlreadyExists("lock")&&this.buryMessageFromLine(this.treeBuryGroup,n,"lock","lock")},r.prototype.destroyBuryLayers=function(){this.treeBuryGroup.removeAll(!0,!1),this.destroyLayer("lockpick"),this.destroyLayer("lock"),this.destroyLayer("leafs")},r.prototype.destroyLayer=function(t){var n=this[t];if(n===undefined)return;this[t]=undefined,n.destroy()},r.prototype.hasntBeenUnburied=function(t){return this.unburiedLayers===undefined||this.unburiedLayers[t]===undefined},r.prototype.lineWithThatCharExistsOnText=function(t){return t!==-1},r.prototype.setBuryLayersToAlpha=function(){this.buryLayerAlreadyExists("lockpick")&&(this.lockpick.alpha=0,this.setBuryLayersToNotClickable(this.lockpick)),this.buryLayerAlreadyExists("lock")&&(this.lock.alpha=.2,this.setBuryLayersToNotClickable(this.lock)),this.buryLayerAlreadyExists("leafs")&&(this.leafs.alpha=.2,this.setBuryLayersToNotClickable(this.leafs))},r.prototype.setBuryLayersToSolid=function(){this.buryLayerAlreadyExists("lockpick")&&(this.lockpick.alpha=1,this.setBuryLayersToClickable(this.lockpick)),this.buryLayerAlreadyExists("lock")&&(this.lock.alpha=1,this.setBuryLayersToClickable(this.lock)),this.buryLayerAlreadyExists("leafs")&&(this.leafs.alpha=1,this.setBuryLayersToClickable(this.leafs))},r.prototype.buryLayerAlreadyExists=function(e){return this[e]!==undefined},r.prototype.buryLayerNotAlreadyExists=function(e){return!this.buryLayerAlreadyExists(e)},r.prototype.regexIndexOf=function(e,t,n){var r=e.substring(n||0).search(t);return r>=0?r+(n||0):r},r.prototype.toInteresparceRegexp=function(e,t){var n,r="",i;i=e.replace("*","\\*");for(n=0;n<i.length;n+=1)r+=i.charAt(n),i.charAt(n)!=="\\"&&(r+="["+t+"]*");return r},r.prototype.findLineOfCharacterInText=function(e){var t=this.toInteresparceRegexp(e,"\n"),r=this.regexIndexOf(this.text,t);return Math.floor(r/n)},r}),define("View/UIEngineView/TreeView/TreeSpriteGroupTextSetter",["./LinkSetterToTree","./BurySetterToTree"],function(e,t){"use strict";function r(n,r,i,s){this.treeSpriteGroup=n,this.game=i,this.gestureObserver=s,this.linkSetterToTree=new e,this.burySetterToTree=new t(i,r,s)}var n=16;return r.prototype.createText=function(t,n){this.burySetterToTree.setUnburiedLayers(n),this.setText(t)},r.prototype.setUnburiedLayers=function(e){this.burySetterToTree.setUnburiedLayers(e)},r.prototype.setText=function(t){this.rewriteTextAtributeWithNewTextAndFormatIt(t),this.deletePreviousTreesSprites(),this.addTextImage(),this.linkSetterToTree.setInteractiveLinksToRetroText(this.treeSpriteGroup,this.formatedText,this.id,this.gestureObserver),this.burySetterToTree.handleBuringTextCases(this.text)},r.prototype.rewriteTextAtributeWithNewTextAndFormatIt=function(t){t===undefined&&(t=""),this.text=this.turnReturnIntoSpaces(t),this.formatedText=this.formatText(t)},r.prototype.addTextImage=function(){var t=this.game.add.bitmapText(4,60,"ubuntu",this.formatedText,24);this.textImage=this.treeSpriteGroup.create(0,0,t.generateTexture()),t.destroy(),this.textImage.scale.x=.9,this.textImage.scale.y=.9},r.prototype.addChar=function(t){this.setEditing(!0),this.setText(this.text+t)},r.prototype.removeChar=function(){this.setText(this.text.substring(0,this.text.length-1))},r.prototype.setEditing=function(t){this.editing=t,this.burySetterToTree.setEditing(t)},r.prototype.startTyping=function(){this.setEditing(!0),this.setText(this.text)},r.prototype.stopTyping=function(){this.setEditing(!1),this.setText(this.text)},r.prototype.getHeightOfLeafBuryLayer=function(){return this.burySetterToTree.getHeightOfLeafBuryLayer()},r.prototype.unBury=function(e){return this.burySetterToTree.unBury(e)},r.prototype.formatText=function(e){var t="",r=n,i;e=this.turnReturnIntoSpaces(e),this.editing===!0?e+="|":e+=" ";for(i=0;i<e.length;i+=r)t+=e.substring(i,i+r)+"\n";return t+=e.substring(i),t},r.prototype.turnReturnIntoSpaces=function(e){var t="",r=n-e.indexOf("	")%n,i;for(i=0;i<r;i+=1)t+=" ";return e=e.replace("	",t),e},r.prototype.deletePreviousTreesSprites=function(){this.textImage!==undefined&&this.textImage.destroy(),this.linkSetterToTree.removeLinks(),this.burySetterToTree.destroyBuryLayers()},r}),define("View/UIEngineView/DistanceTips/TreeSpriteKmDigit",[],function(){"use strict";function e(e,t,n,r){this.parentGroup=r,this.createSpritesAndGroup(n),this.setDigitToBlank(),this.setXY(e,t),this.setScale(.55)}return e.prototype.createSpritesAndGroup=function(t){this.game=t.game,this.phaserGame=t,this.group=this.phaserGame.add.group(),this.parentGroup.add(this.group),this.createSpritesHash()},e.prototype.createSpritesHash=function(){var t;this.spriteHash={};for(t=0;t<10;t+=1)this.addToHashAndSetInvisible(t);this.addToHashAndSetInvisible("n"),this.addToHashAndSetInvisible("m"),this.addToHashAndSetInvisible("k")},e.prototype.addToHashAndSetInvisible=function(t){this.spriteHash[t]=this.group.create(0,0,t+"km"),this.spriteHash[t].visible=!1},e.prototype.setXY=function(t,n){this.x=t,this.y=n,this.setXYfromSettedPosition()},e.prototype.setXYfromSettedPosition=function(){this.group.x=this.x,this.group.y=this.y},e.prototype.setScale=function(t){this.scale=t,this.setScalefromSetted()},e.prototype.setScalefromSetted=function(){this.sprite.scale.x=this.scale,this.sprite.scale.y=this.scale},e.prototype.setXYScaleFromSetted=function(){this.setXYfromSettedPosition(),this.setScalefromSetted()},e.prototype.setDigit=function(e){this.sprite!==undefined&&(this.sprite.visible=!1),this.sprite=this.spriteHash[e],this.sprite.visible=!0,this.setXYScaleFromSetted()},e.prototype.setDigitToBlank=function(){this.setDigit("n")},e}),define("View/UIEngineView/DistanceTips/TreeSpriteCounterKmSetter",["./TreeSpriteKmDigit"],function(e){"use strict";function i(e,t){this.phaserGame=t,this.treeSpriteGroup=e,this.counterGroup=this.phaserGame.add.group(),this.treeSpriteGroup.add(this.counterGroup),this.digits={},this.loadDigits(9)}var t=13,n=20,r=340;return i.prototype.loadDigits=function(s){var o;this.amountOfDigits=s;for(o=0;o<s;o+=1)this.digits[o]=new e(t+n*o,r,this.phaserGame,this.counterGroup)},i.prototype.setDistance=function(t){var n=""+t+"k";this.setAllDigitsToBlank();for(var r=0;r<this.amountOfDigits;r++)n.length>r&&this.digits[this.amountOfDigits-n.length+r].setDigit(n.charAt(r))},i.prototype.setAllDigitsToBlank=function(){for(var e=0;e<this.amountOfDigits;e++)this.digits[e].setDigitToBlank()},i}),define("View/UIEngineView/DistanceTips/TreeSpriteCompas",[],function(){"use strict";function e(e,t,n,r){this.parentGroup=e,this.createSpritesAndGroup(t),this.setScale(.5),this.centerNeedle(),this.setXY(n,r)}return e.prototype.createSpritesAndGroup=function(t){this.game=t.game,this.phaserGame=t,this.group=this.phaserGame.add.group(),this.parentGroup.add(this.group),this.createSprites()},e.prototype.createSprites=function(){this.background=this.group.create(0,0,"compasBg"),this.needle=this.group.create(0,0,"needle")},e.prototype.centerNeedle=function(){this.needle.x=this.needle.width/2,this.needle.y=this.needle.width/2,this.needle.anchor.setTo(.5,.5)},e.prototype.setXY=function(t,n){this.x=t,this.y=n,this.setXYfromSettedPosition()},e.prototype.setXYfromSettedPosition=function(){this.group.x=this.x,this.group.y=this.y},e.prototype.setScale=function(t){this.scale=t,this.setScalefromSetted()},e.prototype.setScalefromSetted=function(){this.needle.scale.x=this.scale,this.needle.scale.y=this.scale,this.background.scale.x=this.scale,this.background.scale.y=this.scale},e.prototype.setXYScaleFromSetted=function(){this.setXYfromSettedPosition(),this.setScalefromSetted()},e.prototype.setAngle=function(e){this.needle.angle=e},e}),define("View/UIEngineView/DistanceTips/TreeSpriteCompassSetter",["./TreeSpriteCompas"],function(e){"use strict";function r(e,t){this.phaserGame=t,this.parentGroup=e,this.loadCompas()}var t=79,n=268;return r.prototype.loadCompas=function(){this.compassSetter=new e(this.parentGroup,this.phaserGame,t,n)},r.prototype.setAngle=function(t){this.compassSetter.setAngle(t)},r.prototype.getCompassPosition=function(){return this.compassSetter.background.world},r}),define("scenes/Constants",[],function(){"use strict";return{compass:{x:79,y:268},specialTreesCodes:{en:1,es:2,ca:3,defaultLanguage:1,fullForest:99},specialTreesHelpTreesIds:{en:4048,es:4050,ca:4049}}}),define("View/UIEngineView/TreeView/SingleTreeGroupFactory",["./TreeSpriteGroupTextSetter","../DistanceTips/TreeSpriteCounterKmSetter","../DistanceTips/TreeSpriteCompassSetter","../../../scenes/Constants"],function(e,t,n,r){"use strict";function i(e,t,n){this.game=e.game,this.phaserGame=e,this.mainGroup=t,this.gestureObserver=n,this.textImage=undefined}return i.prototype.createTreeSpriteGroup=function(s,o){this.group=this.phaserGame.game.add.group(),this.textGroup=this.phaserGame.game.add.group(),this.buryGroup=this.phaserGame.game.add.group(),this.compasAndKmGroup=this.phaserGame.game.add.group(),s.treeid!==null?s.treeid===r.specialTreesCodes.fullForest?(this.sprite=this.group.create(0,0,"fullTerritory"),this.group.isReusable=!1):this.sprite=this.group.create(0,0,"real"):this.sprite=this.group.create(0,0,"roots"),s.treeid===r.specialTreesCodes.ca&&(this.welcomeMessage=this.group.create(0,0,"welcomeCa"),this.setHelpButtonOfWelcomeScreen("ca")),s.treeid===r.specialTreesCodes.en&&(this.welcomeMessage=this.group.create(0,0,"welcomeEn"),this.setHelpButtonOfWelcomeScreen("en")),s.treeid===r.specialTreesCodes.es&&(this.welcomeMessage=this.group.create(0,0,"welcomeEs"),this.setHelpButtonOfWelcomeScreen("es")),this.group.add(this.textGroup),this.group.add(this.buryGroup),this.group.add(this.compasAndKmGroup),this.sprite.anchor.x=.26,this.sprite.anchor.y=172/611,this.group.x=this.phaserGame.coordX(s.x),this.group.y=this.phaserGame.coordY(s.y),this.setScalePropertiesToNewGroup(s),this.sprite.name="treeSprite",this.setTreeGroupIntoAllSpritesGroup(o),s.unburiedLayersTreeLevel===undefined&&(s.unburiedLayersTreeLevel=undefined);if(s.treeid===r.specialTreesCodes.fullForest)return;this.isNotAnEmptyTree(s)&&(this.group.textSetter=new e(this.textGroup,this.buryGroup,this.game,this.gestureObserver),this.group.textSetter.setUnburiedLayers(s.unburiedLayersTreeLevel),this.group.textSetter.createText(s.text),this.isNotAnInstructionTree(s)&&(this.group.kmSetter=new t(this.group,this.game),this.group.compassSetter=new n(this.group,this.game),this.group.isWrittenByAServerTree=!0)),s.treeid===null&&(this.group.isReusable=!1,this.setWriteTextButtonToGroup(s),this.group.textSetter=new e(this.textGroup,this.buryGroup,this.game,this.gestureObserver),this.group.textSetter.createText(" ",s.unburiedLayersTreeLevel))},i.prototype.reuseTreeSpriteGroup=function(t,n,r){this.group=r,this.sprite.anchor.x=.26,this.sprite.anchor.y=172/611,this.group.x=this.phaserGame.coordX(t.x),this.group.y=this.phaserGame.coordY(t.y),this.setScalePropertiesToNewGroup(t),this.setTreeGroupIntoAllSpritesGroup(n);if(t.unburiedLayersTreeLevel===undefined||t.initialPosition.charAt(0)==="3")t.unburiedLayersTreeLevel={};t.text!==undefined&&(this.group.textSetter.setUnburiedLayers(t.unburiedLayersTreeLevel),this.group.textSetter.setText(t.text))},i.prototype.setScalePropertiesToNewGroup=function(t){var n=t.w/this.sprite.width,r=this.phaserGame.scale,i=n*r;this.group.scale.setTo(i,i)},i.prototype.isNotAnEmptyTree=function(e){return e.text!==undefined&&e.text!==null},i.prototype.isNotAnInstructionTree=function(e){return e.treeid>30},i.prototype.setWriteTextButtonToGroup=function(t){var n,r,i;n=this.group.create(t.button.x,t.button.y,"punzon"),this.group.buttonSprite=n,n.name="button",n.height=t.button.hw,n.width=t.button.hw,n.inputEnabled=!0,n.input.priorityID=1,n.useHandCursor=!0,i=this.game.add.tween(n).to({y:t.button.y-100},500,"Linear",!0,0,-1),i.yoyo(!0,500),r={observer:this.gestureObserver,button:n,game:this.game,previousTween:i,group:this.group},n.events.onInputDown.add(function(){var e;this.game.add.tween(this.button).to({alpha:0},300,"Linear",!0,0,0),this.game.add.tween(this.group).to({y:this.group.y+550+300},300,"Linear",!0,0,0),this.game.tweens.remove(this.previousTween),this.button.inputEnabled=!1,this.button.useHandCursor=!1,this.observer.clickedOnWriteButton(),e=this.game.add.audio("plant"),e.play()},r)},i.prototype.setTreeGroupIntoAllSpritesGroup=function(t,n){n!==undefined&&(this.group=n),this.group.name=t,this.mainGroup.add(this.group)},i.prototype.setHelpButtonOfWelcomeScreen=function(e){var t=this.group.create(40,270,"linkLayer");t.scale.x=13,t.inputEnabled=!0,t.input.priorityID=1,t.useHandCursor=!0,t.events.onInputDown.add(function(){this.context.gestureObserver.linkClicked(r.specialTreesHelpTreesIds[e])},{context:this})},i}),define("View/SpriteLevel/SpriteManagerPhaserApi",["../UIEngineView/TreeView/SingleTreeGroupFactory"],function(e){"use strict";function t(t,n){this.allSpritesGroup=t.game.add.group(),this.state="ok",this.game=t.game,this.phaserGame=t,this.singleTreeGroupFactory=new e(t,this.allSpritesGroup,n),t.scaleToReal(40),this.deletedSpriteGroupsWithText=[],this.deletedSpriteGroupsWithoutText=[]}return t.prototype.tellAllActiveSpritesSoItCanUpdateIt=function(t){this.addTreesThatExistOnTheIncommingListButNotInGroup(t),this.removeSpritesThatNoLongerExistInTheIncommingList(t)},t.prototype.addTreesThatExistOnTheIncommingListButNotInGroup=function(t){var n,r;for(n in t)t.hasOwnProperty(n)&&(this.existsId(t[n])||(r=this.askForTreeToSceneLoader(t[n]),this.createTreeSpriteGroup(r,t[n]),r.tween!==undefined&&(this.tweenStprite(t[n],r),this.enableButtonOfSpriteIfItBecomesCentral(t[n],r))))},t.prototype.removeSpritesThatNoLongerExistInTheIncommingList=function(t){var n=this.allSpritesGroup.length,r=[],i,s,o,u,a;for(i=0;i<n;i+=1){s=this.allSpritesGroup.getAt(i).name,o=!1;for(u in t)t.hasOwnProperty(u)&&t[u]===s&&(o=!0);o||r.push(s)}for(a in r)r.hasOwnProperty(a)&&this.deleteTreeSpriteGroup(r[a])},t.prototype.askForTreeToSceneLoader=function(t){return this.sceneLoaderInterface.getTreeFromId(t)},t.prototype.createTreeSpriteGroup=function(t,n){var r;t.text!==null&&t.treeid>30&&(t.text===undefined?r=this.deletedSpriteGroupsWithoutText.pop():r=this.deletedSpriteGroupsWithText.pop()),r===undefined?this.singleTreeGroupFactory.createTreeSpriteGroup(t,n):this.singleTreeGroupFactory.reuseTreeSpriteGroup(t,n,r)},t.prototype.tweenStprite=function(t,n){var r=this.findTreeSpriteGroupByName(t),i=n.tween,s=this.findTreeSpriteById(t),o=this.phaserGame.scaleToReal(i.w),u=o/(s.width/s.scale.x);this.game.add.tween(r).to({x:this.phaserGame.coordX(i.x),y:this.phaserGame.coordY(i.y)},i.t,"Linear",!0,0,0),this.game.add.tween(r.scale).to({x:u,y:u},i.t,"Linear",!0,0,0)},t.prototype.tweenTint=function(t,n,r,i){var s={step:0},o=this.game.add.tween(s).to({step:10},i),u=(r-n)/10;o.onUpdateCallback(function(){var e=n+u*s.step;t.tint=Phaser.Color.getColor(e,e,e)}),t.tint=n,o.start()},t.prototype.enableButtonOfSpriteIfItBecomesCentral=function(t,n){var r;if(n.text!==undefined||n.tween===undefined)return;r=this.findTreeButtonById(t);if(r===undefined||r===null)return;n.finalPosition==="1c"?r.inputEnabled=!0:r.inputEnabled=!1},t.prototype.size=function(){return this.allSpritesGroup.length},t.prototype.deleteTreeSpriteGroup=function(t){var n=this.findTreeSpriteGroupByName(t);this.allSpritesGroup.remove(n),n.usReusable>30&&(n.isWrittenByAServerTree?this.deletedSpriteGroupsWithText.push(n):this.deletedSpriteGroupsWithoutText.push(n))},t.prototype.findTreeSpriteGroupByName=function(t){return this.allSpritesGroup.iterate("name",t,Phaser.Group.RETURN_CHILD)},t.prototype.findTreeSpriteById=function(t){var n=this.findTreeSpriteGroupByName(t);return n.iterate("name","treeSprite",Phaser.Group.RETURN_CHILD)},t.prototype.findTreeButtonById=function(t){var n=this.findTreeSpriteGroupByName(t);return n.iterate("name","button",Phaser.Group.RETURN_CHILD)},t.prototype.existsId=function(t){return this.findTreeSpriteGroupByName(t)!==null},t}),define("InputOutput/CookieManager",["../lib/underscore"],function(e){"use strict";function t(){}return t.prototype.setCookie=function(t,n,r){var i=new Date;r=r===undefined?1e4:r,i.setTime(i.getTime()+r*24*60*60*1e3);var s="expires="+i.toUTCString();document.cookie=t+"="+n+"; "+s},t.prototype.getCookie=function(e){var t=e+"=",n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=n[r];while(i.charAt(0)==" ")i=i.substring(1);if(i.indexOf(t)==0)return i.substring(t.length,i.length)}return""},t.prototype.deleteCookie=function(e){this.setCookie(e,"")},t}),define("InputOutput/GpsBrowserBlockChecker",["../lib/underscore","./CookieManager"],function(e,t){"use strict";function n(e,n,r,i){this.gpsInterface=e,this.loadingTimeLineToTellToContinue=r,this.gpsErrorMessageDisplayerInterface=i,this.reloadInterface=n,this.cookieManager=new t}return n.prototype.start=function(){switch(this.cookieManager.getCookie("gpsOn")){case"true":this.testGps();break;case"test":this.gpsErrorMessageDisplayerInterface.displayUnblockGpsMessage(),setTimeout(_.bind(this.testGps,this),4e3);break;case"":this.gpsErrorMessageDisplayerInterface.displayAcceptRequestMessage(),setTimeout(_.bind(this.testGps,this),4e3)}},n.prototype.testGps=function(){var t={timeout:5e3,enableHighAccuracy:!1};this.gpsInterface.getCurrentPosition(_.bind(this.succesfullCallback,this),_.bind(this.errorCallback,this),t)},n.prototype.succesfullCallback=function(){this.loadingTimeLineToTellToContinue.gpsIsEnabledAndWorking(),this.cookieManager.setCookie("gpsOn","true")},n.prototype.errorCallback=function(){this.cookieManager.setCookie("gpsOn","test"),this.reloadInterface.reload()},n}),define("View/UIEngineView/UiCore/PhaserGame",["../../../InputOutput/GpsBrowserBlockChecker"],function(e){"use strict";function s(e,t){this.gestureObserver=t,this.scale=.5,this.virtualWidth=r,this.virtualHeight=i,n=e;var s=document.getElementById("canvasBg");s!==null&&s.parentNode.removeChild(s),this.game=new Phaser.Game(r,i,Phaser.CANVAS,this),this.gameState={preload:this.preload,create:this.create,update:this.update,render:this.render},this.bootState={preload:function(){this.game.load.image("aaaa","/VisitTreeNumber/assets/spaceKey.png")},create:function(){this.state.start("GameState")}},this.game.state.add("Boot",this.bootState),this.game.state.add("GameState",this.gameState),this.lastSwipeTime=Date.now(),this.game.state.start("Boot"),this.ignorePrecision=!1}var t=window,n,r=480,i=640,o=function(e,t){var n=document.getElementById(e);n!==null&&(t===undefined?f(n):n.style.display="block")},u=function(e,t){var n=document.getElementById(e);n!==null&&(t===undefined?a(n):n.style.display="none")},a=function(t){var n=1,r=setInterval(function(){n<=.1&&(clearInterval(r),t.style.display="none"),t.style.opacity=n,t.style.filter="alpha(opacity="+n*100+")",n-=n*.1},1)},f=function(t){var n=.1;t.style.display="block";var r=setInterval(function(){n>=1&&clearInterval(r),t.style.opacity=n,t.style.filter="alpha(opacity="+n*100+")",n+=n*.1},1)},l=function(e){var t=document.getElementById("calibratingGPSPrecision");t!==null&&(t.textContent="precision: "+Math.floor(e)+" expected: 14")},c=function(e){var t=document.getElementById(e);t.textContent=""};return s.prototype.handleIncorrect=function(){},s.prototype.handleCorrect=function(){},s.prototype.removeWelcomeScreen=function(){u("welcomeScreen")},s.prototype.handleDesktop=function(){o("desktopWarning")},s.prototype.handleMobile=function(){u("desktopWarning")},s.prototype.ignorePrecisionGps=function(){this.ignorePrecision=!0,u("calibratingGPS0",!0),u("calibratingGPS2",!0),u("calibratingGPS5",!0),u("calibratingGPS7",!0),u("calibratingGPS9",!0),c("calibratingGPSPrecision")},s.prototype.handlePrecisionGps=function(t,n){u("calibratingGPS0",!0),u("calibratingGPS2",!0),u("calibratingGPS5",!0),u("calibratingGPS7",!0),u("calibratingGPS9",!0),c("calibratingGPSPrecision");if(this.ignorePrecision)return;t===0?(o("calibratingGPS0",!0),l(n)):t<3?(o("calibratingGPS2",!0),l(n)):t<6?(o("calibratingGPS5",!0),l(n)):t<8?(o("calibratingGPS7",!0),l(n)):t<10&&(o("calibratingGPS9",!0),l(n))},s.prototype.preload=function(){this.game.time.advancedTiming=!0,this.game.stage.backgroundColor="#99b4cf";var t=this.game.add.sprite(50,50,"aaaa");this.load.setPreloadSprite(t),this.game.parent.loadImages(),this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.refresh(),this.game.scale.pageAlignHorizontally=!0,this.game.scale.pageAlignVertically=!0,this.game.scale.forceOrientation(!1,!0),this.game.scale.enterIncorrectOrientation.add(this.game.parent.handleIncorrect),this.game.scale.leaveIncorrectOrientation.add(this.game.parent.handleCorrect),this.game.device.desktop?this.game.parent.handleDesktop():this.game.parent.handleMobile(),this.game.loading=t},s.prototype.loadImages=function(){this.game.load.image("real","/VisitTreeNumber/assets/realDimensionTree3.png"),this.game.load.image("roots","/VisitTreeNumber/assets/treeWithRoots.png"),this.game.load.image("punzon","/VisitTreeNumber/assets/punzon.png"),this.game.load.image("fullTerritory","/VisitTreeNumber/assets/fullTerritory.png"),this.game.load.image("keyboardBackground","/VisitTreeNumber/assets/fondoTeclat.png"),this.game.load.image("keyBackground","/VisitTreeNumber/assets/keyBackground.png"),this.game.load.image("keySpace","/VisitTreeNumber/assets/spaceKey.png"),this.game.load.image("keyEnter","/VisitTreeNumber/assets/enter.png"),this.game.load.image("keyBackwards","/VisitTreeNumber/assets/keyBackwards.png"),this.game.load.image("keyOk","/VisitTreeNumber/assets/keyOk.png"),this.game.load.image("keyCancel","/VisitTreeNumber/assets/keyCancel.png"),this.game.load.image("keySwitchKeyboard","/VisitTreeNumber/assets/keySwitchKeyboard.png"),this.game.load.image("lock","/VisitTreeNumber/assets/lock.png"),this.game.load.image("lockpick","/VisitTreeNumber/assets/lockpick.png"),this.game.load.image("leafs","/VisitTreeNumber/assets/pileOfLeafs.png"),this.game.load.image("leafspick","/VisitTreeNumber/assets/leaf.png"),this.game.load.image("carved","/VisitTreeNumber/assets/alphabet2.png"),this.game.load.image("linkLayer","/VisitTreeNumber/assets/linkLayer.png"),this.game.load.image("passwordBox","/VisitTreeNumber/assets/passwordBox.png"),this.game.load.image("lockBg","/VisitTreeNumber/assets/lockBg.png"),this.game.load.image("buryBg","/VisitTreeNumber/assets/buryBg.png"),this.game.load.image("twitterBg","/VisitTreeNumber/assets/twitterBg.png"),this.game.load.image("linkBg","/VisitTreeNumber/assets/linkBg.png"),this.game.load.image("heartBg","/VisitTreeNumber/assets/heartBg.png"),this.game.load.image("catBg","/VisitTreeNumber/assets/catBg.png"),this.game.load.image("downVote","/VisitTreeNumber/assets/downVote.png"),this.game.load.image("upVote","/VisitTreeNumber/assets/upVote.png"),this.game.load.image("flower","/VisitTreeNumber/assets/flower.png"),this.game.load.image("alphalayer","/VisitTreeNumber/assets/alphaLayer.png"),this.game.load.image("alphalayerbg","/VisitTreeNumber/assets/alphaLayerBg.png"),this.game.load.image("map","/VisitTreeNumber/assets/alphaLayerBg.png"),this.game.load.audio("bell",["/VisitTreeNumber/assets/bell.ogg"]),this.game.load.audio("plant",["/VisitTreeNumber/assets/plant.ogg"]),this.game.load.audio("unbell",["/VisitTreeNumber/assets/unbell.ogg"]);var t;for(t=0;t<10;t+=1)this.game.load.image(t+"km","/VisitTreeNumber/assets/"+t+"km.png");t="n",this.game.load.image(t+"km","/VisitTreeNumber/assets/"+t+"km.png"),t="m",this.game.load.image(t+"km","/VisitTreeNumber/assets/"+t+"km.png"),t="k",this.game.load.image(t+"km","/VisitTreeNumber/assets/"+t+"km.png"),this.game.load.image("compasBg","/VisitTreeNumber/assets/compasBg.png"),this.game.load.image("needle","/VisitTreeNumber/assets/needle.png"),this.game.load.image("notPreciseAlert","/VisitTreeNumber/assets/notPreciseAlert.png"),this.game.load.image("yesPreciseAlert","/VisitTreeNumber/assets/yesPreciseAlert.png"),this.game.load.bitmapFont("ubuntu","/VisitTreeNumber/assets/font.png","/VisitTreeNumber/assets/font.fnt"),this.game.load.image("welcomeCa","/VisitTreeNumber/assets/welcomeCa.png"),this.game.load.image("welcomeEn","/VisitTreeNumber/assets/welcomeEn.png"),this.game.load.image("welcomeEs","/VisitTreeNumber/assets/welcomeEs.png")},s.prototype.create=function(){var t=(new Date).getTime()-this.game.zoomStartedMillieconds,n=this.game.mapZoomTotalMilliseconds-t;setTimeout(this.game.parent.afterMapZoomStartGame,n,this)},s.prototype.afterMapZoomStartGame=function(r){r.game.world.setBounds(0,0,t.innerWidth,t.innerHeight),r.game.input.addPointer(),setTimeout(n(r),0),r.game.stage.backgroundColor="#93fbbc",r.game.world.remove(r.game.loading),r.game.world.remove(r.game.map)},s.prototype.coordX=function(t){return t*this.scale+r/2},s.prototype.coordY=function(t){return t*this.scale+i/2},s.prototype.scaleToReal=function(t){return t*this.scale},s.prototype.resizeSprite=function(t){this.game.scale.scaleSprite(t,t.width*this.scale,t.height*this.scale,!0)},s.prototype.resizeSpriteToSize=function(t,n,r){this.game.scale.scaleSprite(t,n*this.scale,r*this.scale,!0)},s.prototype.update=function(){this.game.parent.gestureObserver.updatePointer(this.game.input.activePointer)},s.prototype.render=function(){this.game.debug.text(this.game.time.fps||"--",2,14,"#ffff00")},s}),define("InputOutput/GestureObserver",["../lib/underscore"],function(e){"use strict";function t(e){this.bussinesInput=e,this.lastSwipeTime=Date.now()}return t.prototype.updatePointer=function(t){var n=this.detectSwipe(t);if(!n)return;n==="right"?this.bussinesInput.swipeRight():this.bussinesInput.swipeLeft()},t.prototype.linkClicked=function(e){this.bussinesInput.linkClicked(e),console.log("link clicked")},t.prototype.detectSwipe=function(t){var n;return this.lastSwipeElapsed=Date.now()-this.lastSwipeTime,n=this.isSwipe(t),this.updateTimeIfSwipe(n),n?this.returnLeftOrRight(t):!1},t.prototype.isSwipe=function(t){var n,r,i,s;return n=Phaser.Point.distance(t.position,t.positionDown)>40,r=t.duration>50,i=t.duration<600,s=this.lastSwipeElapsed>600,n&&r&&i&&s},t.prototype.updateTimeIfSwipe=function(t){t&&(this.lastSwipeTime=Date.now())},t.prototype.returnLeftOrRight=function(t){return t.positionDown.x>t.position.x?"right":"left"},t.prototype.clickedOnWriteButton=function(){this.bussinesInput.clickedOnWriteButton()},t.prototype.clickedOnKey=function(e){this.bussinesInput.clickedOnKey(e)},t.prototype.buriedLayerEvent=function(t){this.bussinesInput.buriedLayerEvent(t)},t.prototype.upvoteTree=function(t){this.bussinesInput.voteEmmited(id,inc)},t.prototype.downvoteTree=function(t){this.bussinesInput.voteEmmited(id,inc)},t}),!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("lib/restful",t):"object"==typeof exports?exports.restful=t():e.restful=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e,t){var n={baseUrl:e,port:t||80,prefixUrl:"",protocol:"http"},r=function(){var e={_http:c(l),headers:{},requestInterceptors:[],responseInterceptors:[]},t={url:function(e){var t=function(){return e.apply(this,arguments)};return t.toString=function(){return e.toString()},t}(function(){var e=n.protocol+"://"+n.baseUrl;return 80!==n.port&&(e+=":"+n.port),""!==n.prefixUrl&&(e+="/"+n.prefixUrl),e})};return o(t,e),s(function(){return e._http},t)}(),i={_url:null,customUrl:function(e){return"undefined"==typeof e?this._url:(this._url=e,this)},url:function(){return r.url()},one:function(e,t){return a(e,t,i)},oneUrl:function(e,t){return this.customUrl(t),this.one(e,null)},all:function(e){return u(e,i)},allUrl:function(e,t){return this.customUrl(t),this.all(e)}};return i=s(f(r),i),o(i,n),i}var i=function(e){return e&&e.__esModule?e["default"]:e};e.exports=r;var s=i(n(1)),o=i(n(2)),u=i(n(3)),a=i(n(8)),f=i(n(9)),l=i(n(10)),c=i(n(30))},function(e,t,n){"use strict";function r(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=Object.assign||function(e,t){for(var n,i,s=r(e),o=1;o<arguments.length;o++){n=arguments[o],i=Object.keys(Object(n));for(var u=0;u<i.length;u++)s[i[u]]=n[i[u]]}return s}},function(e,t,n){"use strict";function r(e,t){for(var n in t)t.hasOwnProperty(n)&&!function(n){e[n]=function(r){return arguments.length?(t[n]=r,e):t[n]}}(n)}e.exports=r},function(e,t,n){"use strict";function r(e,t){function n(e){var n=o(i+"/"+e,t());return n.headers(l.headers()).responseInterceptors(l.responseInterceptors()).requestInterceptors(l.requestInterceptors()),n}function r(n){var r=a(e,n,t);return r().headers(l.headers()).responseInterceptors(l.responseInterceptors()).requestInterceptors(l.requestInterceptors()),r}var i=t.customUrl&&t.customUrl()?t.customUrl():[t.url(),e].join("/"),l=o(i,t()),h={get:function(e,t,i){return n(e).get(t,i).then(function(e){return u(e,r)})},getAll:function(e,t){return l.getAll(e,t).then(function(e){return u(e,r)})},post:function(e,t){return l.post(e,t).then(function(e){return u(e)})},put:function(e,t,r){return n(e).put(t,r).then(function(e){return u(e)})},patch:function(e,t,r){return n(e).patch(t,r).then(function(e){return u(e)})},head:function(e,t,r){return n(e).head(t,r).then(function(e){return u(e)})},"delete":function(e,t){return n(e)["delete"](t).then(function(e){return u(e)})},url:function(e){var t=function(){return e.apply(this,arguments)};return t.toString=function(){return e.toString()},t}(function(){return i})};return s(f(l),h)}var i=function(e){return e&&e.__esModule?e["default"]:e};e.exports=r;var s=i(n(1)),o=i(n(4)),u=i(n(6)),a=i(n(8)),f=i(n(9))},function(e,t,n){"use strict";function r(e,t){function n(){for(var e=l,t=[];e;)t=t.concat(e.requestInterceptors()),e=e._parent?e._parent():null;return t}function r(){for(var e=l,t=[];e;)t=t.concat(e.responseInterceptors()),e=e._parent?e._parent():null;return t}function i(){for(var e=l,t={};e;)s(t,e.headers()),e=e._parent?e._parent():null;return t}function a(e){var t=void 0===arguments[1]?{}:arguments[1],o=void 0===arguments[2]?{}:arguments[2],a=void 0===arguments[3]?null:arguments[3],f={url:e,params:t||{},headers:s({},i(),o||{}),responseInterceptors:r()};return a&&(f.data=a,f.requestInterceptors=n()),f}var f={_parent:t,headers:{},requestInterceptors:[],responseInterceptors:[]},l={get:function(t,n){return f._parent().request("get",a(e,t,n))},getAll:function(t,n){return f._parent().request("get",a(e,t,n))},post:function(t,n){return n=n||{},n["Content-Type"]||(n["Content-Type"]="application/json;charset=UTF-8"),f._parent().request("post",a(e,{},n,t))},put:function(t,n){return n=n||{},n["Content-Type"]||(n["Content-Type"]="application/json;charset=UTF-8"),f._parent().request("put",a(e,{},n,t))},patch:function(t,n){return n=n||{},n["Content-Type"]||(n["Content-Type"]="application/json;charset=UTF-8"),f._parent().request("patch",a(e,{},n,t))},"delete":function(t){return f._parent().request("delete",a(e,{},t))},head:function(t){return f._parent().request("head",a(e,{},t))}};return l=s(function(){return f._parent()},l),o(l,f),l}var i=function(e){return e&&e.__esModule?e["default"]:e};e.exports=r;var s=i(n(1)),o=i(n(2));i(n(5))},function(e,t,n){"use strict";function r(e,t,n){var r={_url:null,customUrl:function(e){return"undefined"==typeof e?this._url:(this._url=e,this)},one:function(e,t){return n.one(e,t)},oneUrl:function(e,t){return this.customUrl(t),this.one(e,null)},all:function(e){return n.all(e)},allUrl:function(e,t){return this.customUrl(t),this.all(e)},save:function(e){return n.put(t,e)},remove:function(e){return n["delete"](e)},url:function(){return n.url()},id:function(e){var t=function(){return e.apply(this,arguments)};return t.toString=function(){return e.toString()},t}(function(){return e}),data:function(e){var t=function(){return e.apply(this,arguments)};return t.toString=function(){return e.toString()},t}(function(){return t})};return s(function(){return t},r)}var i=function(e){return e&&e.__esModule?e["default"]:e};e.exports=r;var s=i(n(1))},function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e["default"]:e},i=r(n(7));e.exports=function(e,t){return new Promise(function(n,r){var s=e.status;return s>=200&&400>s?n(i(e,t)):void r(i(e))})}},function(e,t,n){"use strict";function r(e,t){var n={status:function(){return e.status},body:function(){var n=void 0===arguments[0]?!0:arguments[0];return n&&t?"[object Array]"===Object.prototype.toString.call(e.data)?e.data.map(function(e){return o(e.id,e,t(e.id))}):o(e.data.id,e.data,t(e.data.id)):e.data},headers:function(){return e.headers},config:function(){return e.config}};return s(function(){return e},n)}var i=function(e){return e&&e.__esModule?e["default"]:e};e.exports=r;var s=i(n(1)),o=i(n(5))},function(e,t,n){"use strict";function r(e,t,n){var i=n.customUrl&&n.customUrl()?n.customUrl():[n.url(),e,t].join("/"),l=u(i,n()),h={_url:null,customUrl:function(e){return"undefined"==typeof e?this._url:(this._url=e,this)},get:function(e,t){return l.get(e,t).then(function(e){return a(e,function(){return h})})},put:function(e,t){return l.put(e,t).then(function(e){return a(e)})},patch:function(e,t){return l.patch(e,t).then(function(e){return a(e)})},head:function(e,t){return l.head(e,t).then(function(e){return a(e)})},"delete":function(e){return l["delete"](e).then(function(e){return a(e)})},one:function(e,t){return r(e,t,h)},oneUrl:function(e,t){return this.customUrl(t),this.one(e,null)},all:function(e){return o(e,h)},allUrl:function(e,t){return this.customUrl(t),this.all(e)},url:function(e){var t=function(){return e.apply(this,arguments)};return t.toString=function(){return e.toString()},t}(function(){return i})};return h=s(f(l),h)}var i=function(e){return e&&e.__esModule?e["default"]:e};e.exports=r;var s=i(n(1)),o=i(n(3)),u=i(n(4)),a=i(n(6)),f=i(n(9))},function(e,t,n){"use strict";function r(e){function t(){return e}return t=s(t,{addRequestInterceptor:function(n){return e.requestInterceptors().push(n),t},requestInterceptors:function(){return e.requestInterceptors()},addResponseInterceptor:function(n){return e.responseInterceptors().push(n),t},responseInterceptors:function(){return e.responseInterceptors()},header:function(n,r){return e.headers()[n]=r,t},headers:function(){return e.headers()}})}var i=function(e){return e&&e.__esModule?e["default"]:e};e.exports=r;var s=i(n(1))},function(e,t,n){e.exports=n(11)},function(e,t,n){"use strict";var r=n(12),i=n(13),s=n(14),o=n(15),u=n(23);!function(){var e=n(24);e&&"function"==typeof e.polyfill&&e.polyfill()}();var a=e.exports=function f(e){e=i.merge({method:"get",headers:{},transformRequest:r.transformRequest,transformResponse:r.transformResponse},e),e.withCredentials=e.withCredentials||r.withCredentials;var t=[o,void 0],n=Promise.resolve(e);for(f.interceptors.request.forEach(function(e){t.unshift(e.fulfilled,e.rejected)}),f.interceptors.response.forEach(function(e){t.push(e.fulfilled,e.rejected)});t.length;)n=n.then(t.shift(),t.shift());return n.success=function(e){return s("success","then","https://github.com/mzabriskie/axios/blob/master/README.md#response-api"),n.then(function(t){e(t.data,t.status,t.headers,t.config)}),n},n.error=function(e){return s("error","catch","https://github.com/mzabriskie/axios/blob/master/README.md#response-api"),n.then(null,function(t){e(t.data,t.status,t.headers,t.config)}),n},n};a.defaults=r,a.all=function(e){return Promise.all(e)},a.spread=n(29),a.interceptors={request:new u,response:new u},function(){function e(){i.forEach(arguments,function(e){a[e]=function(t,n){return a(i.merge(n||{},{method:e,url:t}))}})}function t(){i.forEach(arguments,function(e){a[e]=function(t,n,r){return a(i.merge(r||{},{method:e,url:t,data:n}))}})}e("delete","get","head"),t("post","put","patch")}()},function(e,t,n){"use strict";var r=n(13),i=/^\)\]\}',?\n/,s={"Content-Type":"application/x-www-form-urlencoded"};e.exports={transformRequest:[function(e,t){return r.isFormData(e)?e:r.isArrayBuffer(e)?e:r.isArrayBufferView(e)?e.buffer:!r.isObject(e)||r.isFile(e)||r.isBlob(e)?e:(!r.isUndefined(t)&&r.isUndefined(t["Content-Type"])&&(t["Content-Type"]="application/json;charset=utf-8"),JSON.stringify(e))}],transformResponse:[function(e){if("string"==typeof e){e=e.replace(i,"");try{e=JSON.parse(e)}catch(t){}}return e}],headers:{common:{Accept:"application/json, text/plain, */*"},patch:r.merge(s),post:r.merge(s),put:r.merge(s)},xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN"}},function(e,t,n){"use strict";function r(e){return"[object Array]"===g.call(e)}function i(e){return"[object ArrayBuffer]"===g.call(e)}function s(e){return"[object FormData]"===g.call(e)}function o(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer}function u(e){return"string"==typeof e}function a(e){return"number"==typeof e}function f(e){return"undefined"==typeof e}function l(e){return null!==e&&"object"==typeof e}function c(e){return"[object Date]"===g.call(e)}function h(e){return"[object File]"===g.call(e)}function p(e){return"[object Blob]"===g.call(e)}function d(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}function v(e,t){if(null!==e&&"undefined"!=typeof e){var n=r(e)||"object"==typeof e&&!isNaN(e.length);if("object"==typeof e||n||(e=[e]),n)for(var i=0,s=e.length;s>i;i++)t.call(null,e[i],i,e);else for(var o in e)e.hasOwnProperty(o)&&t.call(null,e[o],o,e)}}function m(){var e={};return v(arguments,function(t){v(t,function(t,n){e[n]=t})}),e}var g=Object.prototype.toString;e.exports={isArray:r,isArrayBuffer:i,isFormData:s,isArrayBufferView:o,isString:u,isNumber:a,isObject:l,isUndefined:f,isDate:c,isFile:h,isBlob:p,forEach:v,merge:m,trim:d}},function(e,t,n){"use strict";e.exports=function(e,t,n){try{console.warn("DEPRECATED method `"+e+"`."+(t?" Use `"+t+"` instead.":"")+" This method will be removed in a future release."),n&&console.warn("For more information about usage see "+n)}catch(r){}}},function(e,t,n){(function(t){"use strict";e.exports=function(e){return new Promise(function(r,i){try{"undefined"!=typeof window?n(17)(r,i,e):"undefined"!=typeof t&&n(17)(r,i,e)}catch(s){i(s)}})}}).call(t,n(16))},function(e,t,n){function r(){l=!1,u.length?f=u.concat(f):c=-1,f.length&&i()}function i(){if(!l){var e=setTimeout(r);l=!0;for(var t=f.length;t;){for(u=f,f=[];++c<t;)u[c].run();c=-1,t=f.length}u=null,l=!1,clearTimeout(e)}}function s(e,t){this.fun=e,this.array=t}function o(){}var u,a=e.exports={},f=[],l=!1,c=-1;a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];f.push(new s(e,t)),1!==f.length||l||setTimeout(i,0)},s.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=o,a.addListener=o,a.once=o,a.off=o,a.removeListener=o,a.removeAllListeners=o,a.emit=o,a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(e,t,n){"use strict";var r=n(12),i=n(13),s=n(18),o=n(19),u=n(20),a=n(21),f=n(22);e.exports=function(e,t,n){var l=a(n.data,n.headers,n.transformRequest),h=i.merge(r.headers.common,r.headers[n.method]||{},n.headers||{});i.isFormData(l)&&delete h["Content-Type"];var p=new(XMLHttpRequest||ActiveXObject)("Microsoft.XMLHTTP");p.open(n.method.toUpperCase(),s(n.url,n.params),!0),p.onreadystatechange=function(){if(p&&4===p.readyState){var r=u(p.getAllResponseHeaders()),i=-1!==["text",""].indexOf(n.responseType||"")?p.responseText:p.response,s={data:a(i,r,n.transformResponse),status:p.status,statusText:p.statusText,headers:r,config:n};(p.status>=200&&p.status<300?e:t)(s),p=null}};var d=f(n.url)?o.read(n.xsrfCookieName||r.xsrfCookieName):void 0;if(d&&(h[n.xsrfHeaderName||r.xsrfHeaderName]=d),i.forEach(h,function(e,t){l||"content-type"!==t.toLowerCase()?p.setRequestHeader(t,e):delete h[t]}),n.withCredentials&&(p.withCredentials=!0),n.responseType)try{p.responseType=n.responseType}catch(v){if("json"!==p.responseType)throw v}i.isArrayBuffer(l)&&(l=new DataView(l)),p.send(l)}},function(e,t,n){"use strict";function r(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}var i=n(13);e.exports=function(e,t){if(!t)return e;var n=[];return i.forEach(t,function(e,t){null!==e&&"undefined"!=typeof e&&(i.isArray(e)||(e=[e]),i.forEach(e,function(e){i.isDate(e)?e=e.toISOString():i.isObject(e)&&(e=JSON.stringify(e)),n.push(r(t)+"="+r(e))}))}),n.length>0&&(e+=(-1===e.indexOf("?")?"?":"&")+n.join("&")),e}},function(e,t,n){"use strict";var r=n(13);e.exports={write:function(e,t,n,i,s,o){var u=[];u.push(e+"="+encodeURIComponent(t)),r.isNumber(n)&&u.push("expires="+(new Date(n)).toGMTString()),r.isString(i)&&u.push("path="+i),r.isString(s)&&u.push("domain="+s),o===!0&&u.push("secure"),document.cookie=u.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}},function(e,t,n){"use strict";var r=n(13);e.exports=function(e){var t,n,i,s={};return e?(r.forEach(e.split("\n"),function(e){i=e.indexOf(":"),t=r.trim(e.substr(0,i)).toLowerCase(),n=r.trim(e.substr(i+1)),t&&(s[t]=s[t]?s[t]+", "+n:n)}),s):s}},function(e,t,n){"use strict";var r=n(13);e.exports=function(e,t,n){return r.forEach(n,function(n){e=n(e,t)}),e}},function(e,t,n){"use strict";function r(e){var t=e;return o&&(u.setAttribute("href",t),t=u.href),u.setAttribute("href",t),{href:u.href,protocol:u.protocol?u.protocol.replace(/:$/,""):"",host:u.host,search:u.search?u.search.replace(/^\?/,""):"",hash:u.hash?u.hash.replace(/^#/,""):"",hostname:u.hostname,port:u.port,pathname:"/"===u.pathname.charAt(0)?u.pathname:"/"+u.pathname}}var i,s=n(13),o=/(msie|trident)/i.test(navigator.userAgent),u=document.createElement("a");i=r(window.location.href),e.exports=function(e){var t=s.isString(e)?r(e):e;return t.protocol===i.protocol&&t.host===i.host}},function(e,t,n){"use strict";function r(){this.handlers=[]}var i=n(13);r.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},r.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},r.prototype.forEach=function(e){i.forEach(this.handlers,function(t){null!==t&&e(t)})},e.exports=r},function(e,t,n){var r;(function(e,i,s,o){(function(){"use strict";function a(e){return"function"==typeof e||"object"==typeof e&&null!==e}function f(e){return"function"==typeof e}function l(e){return"object"==typeof e&&null!==e}function c(e,t){rt[Q]=e,rt[Q+1]=t,Q+=2,2===Q&&J()}function h(){var t=e.nextTick,n=e.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);return Array.isArray(n)&&"0"===n[1]&&"10"===n[2]&&(t=i),function(){t(g)}}function p(){return function(){$(g)}}function d(){var e=0,t=new et(g),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function v(){var e=new MessageChannel;return e.port1.onmessage=g,function(){e.port2.postMessage(0)}}function m(){return function(){setTimeout(g,1)}}function g(){for(var e=0;Q>e;e+=2){var t=rt[e],n=rt[e+1];t(n),rt[e]=void 0,rt[e+1]=void 0}Q=0}function y(){try{var e=n(27);return $=e.runOnLoop||e.runOnContext,p()}catch(t){return m()}}function b(){}function w(){return new TypeError("You cannot resolve a promise with itself")}function E(){return new TypeError("A promises callback cannot return that same promise.")}function S(e){try{return e.then}catch(t){return ut.error=t,ut}}function x(e,t,n,r){try{e.call(t,n,r)}catch(i){return i}}function T(e,t,n){G(function(e){var r=!1,i=x(n,t,function(n){r||(r=!0,t!==n?k(e,n):A(e,n))},function(t){r||(r=!0,O(e,t))},"Settle: "+(e._label||" unknown promise"));!r&&i&&(r=!0,O(e,i))},e)}function N(e,t){t._state===st?A(e,t._result):t._state===ot?O(e,t._result):M(t,void 0,function(t){k(e,t)},function(t){O(e,t)})}function C(e,t){if(t.constructor===e.constructor)N(e,t);else{var n=S(t);n===ut?O(e,ut.error):void 0===n?A(e,t):f(n)?T(e,t,n):A(e,t)}}function k(e,t){e===t?O(e,w()):a(t)?C(e,t):A(e,t)}function L(e){e._onerror&&e._onerror(e._result),_(e)}function A(e,t){e._state===it&&(e._result=t,e._state=st,0!==e._subscribers.length&&G(_,e))}function O(e,t){e._state===it&&(e._state=ot,e._result=t,G(L,e))}function M(e,t,n,r){var i=e._subscribers,s=i.length;e._onerror=null,i[s]=t,i[s+st]=n,i[s+ot]=r,0===s&&e._state&&G(_,e)}function _(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r,i,s=e._result,o=0;o<t.length;o+=3)r=t[o],i=t[o+n],r?H(n,r,i,s):i(s);e._subscribers.length=0}}function D(){this.error=null}function P(e,t){try{return e(t)}catch(n){return at.error=n,at}}function H(e,t,n,r){var i,s,o,u,a=f(n);if(a){if(i=P(n,r),i===at?(u=!0,s=i.error,i=null):o=!0,t===i)return void O(t,E())}else i=r,o=!0;t._state!==it||(a&&o?k(t,i):u?O(t,s):e===st?A(t,i):e===ot&&O(t,i))}function B(e,t){try{t(function(t){k(e,t)},function(t){O(e,t)})}catch(n){O(e,n)}}function j(e,t){var n=this;n._instanceConstructor=e,n.promise=new e(b),n._validateInput(t)?(n._input=t,n.length=t.length,n._remaining=t.length,n._init(),0===n.length?A(n.promise,n._result):(n.length=n.length||0,n._enumerate(),0===n._remaining&&A(n.promise,n._result))):O(n.promise,n._validationError())}function F(e){return(new ft(this,e)).promise}function I(e){function t(e){k(i,e)}function n(e){O(i,e)}var r=this,i=new r(b);if(!K(e))return O(i,new TypeError("You must pass an array to race.")),i;for(var s=e.length,o=0;i._state===it&&s>o;o++)M(r.resolve(e[o]),void 0,t,n);return i}function q(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(b);return k(n,e),n}function R(e){var t=this,n=new t(b);return O(n,e),n}function U(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function z(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function W(e){this._id=dt++,this._state=void 0,this._result=void 0,this._subscribers=[],b!==e&&(f(e)||U(),this instanceof W||z(),B(this,e))}function X(){var e;if("undefined"!=typeof s)e=s;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var n=e.Promise;(!n||"[object Promise]"!==Object.prototype.toString.call(n.resolve())||n.cast)&&(e.Promise=vt)}var V;V=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var $,J,K=V,Q=0,G=({}.toString,c),Y="undefined"!=typeof window?window:void 0,Z=Y||{},et=Z.MutationObserver||Z.WebKitMutationObserver,tt="undefined"!=typeof e&&"[object process]"==={}.toString.call(e),nt="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,rt=new Array(1e3);J=tt?h():et?d():nt?v():void 0===Y?y():m();var it=void 0,st=1,ot=2,ut=new D,at=new D;j.prototype._validateInput=function(e){return K(e)},j.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},j.prototype._init=function(){this._result=new Array(this.length)};var ft=j;j.prototype._enumerate=function(){for(var e=this,t=e.length,n=e.promise,r=e._input,i=0;n._state===it&&t>i;i++)e._eachEntry(r[i],i)},j.prototype._eachEntry=function(e,t){var n=this,r=n._instanceConstructor;l(e)?e.constructor===r&&e._state!==it?(e._onerror=null,n._settledAt(e._state,t,e._result)):n._willSettleAt(r.resolve(e),t):(n._remaining--,n._result[t]=e)},j.prototype._settledAt=function(e,t,n){var r=this,i=r.promise;i._state===it&&(r._remaining--,e===ot?O(i,n):r._result[t]=n),0===r._remaining&&A(i,r._result)},j.prototype._willSettleAt=function(e,t){var n=this;M(e,void 0,function(e){n._settledAt(st,t,e)},function(e){n._settledAt(ot,t,e)})};var lt=F,ct=I,ht=q,pt=R,dt=0,vt=W;W.all=lt,W.race=ct,W.resolve=ht,W.reject=pt,W.prototype={constructor:W,then:function(e,t){var n=this,r=n._state;if(r===st&&!e||r===ot&&!t)return this;var i=new this.constructor(b),s=n._result;if(r){var o=arguments[r-1];G(function(){H(r,i,o,s)})}else M(n,i,e,t);return i},"catch":function(e){return this.then(null,e)}};var mt=X,gt={Promise:vt,polyfill:mt};n(28).amd?(r=function(){return gt}.call(t,n,t,o),void 0===r||!(o.exports=r)):"undefined"!=typeof o&&o.exports?o.exports=gt:"undefined"!=typeof this&&(this.ES6Promise=gt),mt()}).call(this)}).call(t,n(16),n(25).setImmediate,function(){return this}(),n(26)(e))},function(e,t,n){(function(e,r){function i(e,t){this._id=e,this._clearFn=t}var s=n(16).nextTick,o=Function.prototype.apply,u=Array.prototype.slice,a={},f=0;t.setTimeout=function(){return new i(o.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new i(o.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},t.setImmediate="function"==typeof e?e:function(e){var n=f++,r=arguments.length<2?!1:u.call(arguments,1);return a[n]=!0,s(function(){a[n]&&(r?e.apply(null,r):e.call(null),t.clearImmediate(n))}),n},t.clearImmediate="function"==typeof r?r:function(e){delete a[e]}}).call(t,n(25).setImmediate,n(25).clearImmediate)},function(e,t,n){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(e,t,n){},function(e,t,n){e.exports=function(){throw new Error("define cannot be used indirect")}},function(e,t,n){"use strict";e.exports=function(e){return function(t){e.apply(null,t)}}},function(e,t,n){"use strict";function r(e,t,n,r){return r=void 0!==r?!!r:!1,function(i,s){if(r)try{i=JSON.parse(i)}catch(o){}for(var u in e)i=e[u](i,s,t,n);if(!r)try{i=JSON.stringify(i)}catch(o){}return i}}function i(e){var t={request:function(t,n){return n.method=t,-1!==["post","put","patch"].indexOf(t)&&(n.transformRequest=[r(n.requestInterceptors||[],n.method,n.url)],delete n.requestInterceptors),n.transformResponse=[r(n.responseInterceptors||[],n.method,n.url,!0)],delete n.responseInterceptors,e(n)}};return o(function(){return e},t)}var s=function(e){return e&&e.__esModule?e["default"]:e};e.exports=i;var o=s(n(1))}])}),define("Model/TreeRestClient",["../lib/underscore","../lib/restful","../lib/rsvp"],function(e,t,n){"use strict";function r(){this.api=t(location.host.split(":")[0]).header("Accept","application/json").prefixUrl("YOUR_PATH").port(8080);var e=location.host.split(":")[0]==="localhost"?"52.35.8.50:80":location.host;this.path="http://"+e+"/YOUR_PATH/trees"}return r.prototype.deleteAll=function(){return this.treeApi=this.api.oneUrl("articles",this.path),console.log("delete"),this.treeApi.delete()},r.prototype.put=function(e){this.treeApi=this.api.oneUrl("articles",this.path);var t=this;return new Promise(function(n,r){t.treeApi.put(e).then(function(e){var t=e.body();t!==null?n(t):(console.log("entity is null"),r("entity is null"))}).catch(function(e){alert("error"),console.log(e.stack)})})},r.prototype.buildDontIncludeString=function(e){var t="[";return e.length===0?"[]":(e.forEach(function(e){t+=e+","}),t.substr(0,t.length-1)+"]")},r.prototype.get=function(e,t,n){var r=this.buildDontIncludeString(n);this.treeApi=this.api.allUrl("articles",this.path);var i=this;return new Promise(function(n,s){i.treeApi.getAll({x:e,y:t,dontInclude:r}).then(function(e){var t=e.body();t!==null?n(t.data()):(console.log("entity is null"),s("entity is null"))}).catch(function(t){alert("impossible to do a get, no internet connection or server is down"),console.log(t.stack)})})},r.prototype.getSpecificTree=function(e){this.treeApi=this.api.allUrl("articles",this.path+"/"+e);var t=this;return new Promise(function(n,r){t.treeApi.getAll({id:e,x:0,y:0}).then(function(e){var t=e.body();t!==null?n(t.data()):(console.log("entity is null"),r("entity is null"))}).catch(function(t){alert("impossible to do a get, no internet connection ir server us down"),console.log(t.stack)})})},r}),define("Controll/NearbyTreesFromServerToIncommingTreeList",["../lib/underscore","../Model/TreeRestClient"],function(e,t){"use strict";function n(e,n,r,i){this.incommingList=e,this.alreadyDisplayed=n,this.treeRestClient=new t,this.mapOfTreesById=r,this.fillerOfIncommingListIfItGetsEmpty=i}return n.prototype.userHasMovedTo=function(e){var t=0,n=this,r;if(e===undefined)return;return r=_.difference(this.alreadyDisplayed,this.incommingList),this.alreadyDisplayed.splice(0,this.alreadyDisplayed.length),r.forEach(function(e){n.alreadyDisplayed.push(e)}),this.treeRestClient.get(e.longitude,e.latitude,this.alreadyDisplayed).then(function(r){n.incommingList.length=0;if(r.treeContent===null)throw"no trees in a get, got a null as ans"+e.longitude+" "+e.latitude;r.treeContent.length===0&&n.fillerOfIncommingListIfItGetsEmpty.treesFromServerAreOver();for(t=0;t<r.treeContent.length;t+=1)n.incommingList.push(r.treeContent[t].id),n.loadTreeToHash(r.treeContent[t]);n.incommingList.emptyTrees=r.emptyTrees}).catch(function(e){alert("error"),console.log("no connection "+e.stack)})},n.prototype.loadSpecificTreeToHash=function(e){var t=this;return this.treeRestClient.getSpecificTree(e).then(function(e){if(e.treeContent===null)throw"notfound";t.mapOfTreesById[e.treeContent.id]=e.treeContent}).catch(function(e){alert("Tree id not found..."),console.log(e.stack)})},n.prototype.loadTreeToHash=function(e){e.text===null&&(e.text="this tree is null"),this.mapOfTreesById[e.id]=e},n}),define("Controll/FillerOfIncommingListIfItGetsEmpty",["../lib/underscore"],function(e){"use strict";function t(e,t){this.incommingList=e,this.updaterOfListInterface=t,this.stopAskingForTrees=!1}return t.prototype.start=function(){this.checkIfEmptyAndFill(),setInterval(_.bind(this.checkIfEmptyAndFill,this),1e3)},t.prototype.checkIfEmptyAndFill=function(){this.incommingList.length===0&&!this.stopAskingForTrees&&this.updaterOfListInterface.updateWithoutMoving()},t.prototype.treesFromServerAreOver=function(){this.stopAskingForTrees=!0,console.log("trees form server are over")},t}),define("util/CoordinatesCalculator",["../lib/underscore"],function(e){"use strict";function t(){}return t.prototype.distanceBetweenCoordinates=function(t,n){var r=t.longitude,i=t.latitude,s=n.longitude,o=n.latitude,u=6378.137,a=(o-i)*Math.PI/180,f=(s-r)*Math.PI/180,l=Math.sin(a/2)*Math.sin(a/2)+Math.cos(i*Math.PI/180)*Math.cos(o*Math.PI/180)*Math.sin(f/2)*Math.sin(f/2),c=2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),h=u*c;return h*1e3},t.prototype.angleWithBetweenCoords=function(t,n){var r=n.longitude,i=n.latitude,s=t.longitude,o=t.latitude,u=o-i,a=Math.cos(Math.PI/180*i)*(s-r),f=Math.atan2(u,a),l=f*(180/Math.PI);return l*-1-90},t}),define("InputOutput/HashChangeTrigger",["util/CoordinatesCalculator","../lib/underscore"],function(e,t){"use strict";function n(e){this.bussinesController=e,this.setUpUpdate()}return n.prototype.setUpUpdate=function(){"onhashchange"in window?window.onhashchange=_.bind(this.update,this):alert(" APP will not work in this browser because it doesent support hashcange")},n.prototype.setHashAtUrlAndStartUpdatingProcess=function(e){this.setHash(e)},n.prototype.setHashAtUrlAndIgnoreUpdatingProcess=function(e){this.ignoreNextUpdate(),this.setHash(e)},n.prototype.setHash=function(t){if(t===null||t===undefined)return;location.hash=t},n.prototype.storeActualHash=function(){this.storedHash=location.hash},n.prototype.restoreStoredHash=function(){location.hash=this.storedHash},n.prototype.triggerIfStoredHashWasNotEmpty=function(){this.isStoredHashEmpty()||this.restoreStoredHash()},n.prototype.isStoredHashEmpty=function(){return this.storedHash===""},n.prototype.removeHash=function(){var t=window.location;"pushState"in history?history.pushState("",document.title,t.pathname+t.search):t.hash=""},n.prototype.update=function(){if(this.ignoreNextUpdateFlag){this.ignoreNextUpdateFlag=!1;return}this.bussinesController.hashHasBeenUpdated(location.hash.substr(1))},n.prototype.ignoreNextUpdate=function(){this.ignoreNextUpdateFlag=!0},n});var forgedAccuracy=12;define("InputOutput/GpsMovmentTrigger",["../lib/underscore","../util/CoordinatesCalculator"],function(e,t){"use strict";function n(e,n){this.metersToTrigger=10,this.isFirstIteration=!0,this.bussinesController=e,this.lastMoveCoordinates=undefined,this.actualCoordinates={longitude:longitude,latitude:latitude},this.coordinatesCalculator=new t,this.options={enableHighAccuracy:!0,timeout:2e4,maximumAge:3e4},this.setUpUpdate(),this.phaserGame=n,this.precisionIsNowImportant=!1,e=this}return n.prototype.setUpUpdate=function(){navigator.geolocation.watchPosition(_.bind(this.userHasMovedUpdateFunction,this),_.bind(this.errorCallback,this),this.options)},n.prototype.forceUpdate=function(){navigator.geolocation.watchPosition(_.bind(this.userHasMovedUpdateFunction,this),_.bind(this.errorCallback,this),this.options)},n.prototype.init=function(t,n){this.relativeLocationCalculator=t,this.leafPileUnburier=n},n.prototype.userHasMovedUpdateFunction=function(t){var n;if(navigator.userAgent.match("emulated")!==null){console.log("Forged accuracy:"+forgedAccuracy),n={coords:{latitude:t.coords.latitude,longitude:t.coords.longitude,accuracy:forgedAccuracy}},this.updateFunction(n);return}this.updateFunction(t)},n.prototype.forceUpdateFunction=function(t){this.handleBegginingOfTrackingIfLastMoveCoordinatesAreUndefined(t),this.actualCoordinates=t.coords,this.bussinesController.userHasMoved(t.coords),this.lastMoveCoordinates=t.coords},n.prototype.updateFunction=function(t){this.handleBegginingOfTrackingIfLastMoveCoordinatesAreUndefined(t);var n=this.coordinatesCalculator.distanceBetweenCoordinates(t.coords,this.lastMoveCoordinates);this.actualCoordinates=t.coords;if(n>this.metersToTrigger||this.isFirstIteration)this.bussinesController.userHasMoved(t.coords),this.lastMoveCoordinates=t.coords,this.isFirstIteration=!1,console.log("GPS: Accuracy:"+t.coords.accuracy+" lattitude:"+t.coords.latitude);this.relativeLocationCalculator!==undefined?this.relativeLocationCalculator.onNewlyLocationOfTheCellPhone(t.coords):console.log("relativeLocationCalculator Not Set Yet"),this.relativeLocationCalculator!==undefined?this.leafPileUnburier.onNewlyLocationOfTheCellPhone(t.coords):console.log("leafPileUnburier Not Set Yet"),this.handlePrecisionAlerts(t.coords.accuracy)},n.prototype.handleBegginingOfTrackingIfLastMoveCoordinatesAreUndefined=function(t){this.lastMoveCoordinates===undefined&&(this.lastMoveCoordinates=t.coords)},n.prototype.errorCallback=function(t){console.log("error tracking coordinates"+t+" "+t.stack)},n.prototype.forceUpdate=function(){navigator.geolocation.getCurrentPosition(_.bind(this.forceUpdateFunction,this),_.bind(this.errorCallback,this),this.options)},n.prototype.handlePrecisionAlerts=function(t){this.precisionInMeters=t,this.precisionOneToTen=0,this.precisionInMeters<35&&(this.precisionOneToTen=2),this.precisionInMeters<20&&(this.precisionOneToTen=5),this.precisionInMeters<18&&(this.precisionOneToTen=7),this.precisionInMeters<16&&(this.precisionOneToTen=9),this.precisionInMeters<14&&(this.precisionOneToTen=10),this.precisionIsNowImportant&&(this.phaserGame.ignorePrecision&&this.bussinesController.handleIgnoredPrecision(this.precisionOneToTen),this.phaserGame.handlePrecisionGps(this.precisionOneToTen,this.precisionInMeters))},n.prototype.forceHandlePrecisionAlerts=function(){this.precisionIsNowImportant&&(this.phaserGame.ignorePrecision&&this.bussinesController.handleIgnoredPrecision(this.precisionOneToTen),this.phaserGame.handlePrecisionGps(this.precisionOneToTen,this.precisionInMeters))},n.prototype.setPrecisionNowIsImportant=function(){this.precisionIsNowImportant=!0,this.handlePrecisionAlerts(this.lastMoveCoordinates.accuracy)},n.prototype.setPrecisionNowIsNotImportant=function(){this.precisionIsNowImportant=!1},n}),define("Controll/TreeLoaderToSceneLoaderFromLists",["../lib/underscore","../lib/rsvp"],function(e,t){"use strict";function n(e,t,n,r,i){this.incommingListAndCurrentEmptyTrees=t,this.sceneLoader=e,this.alreadyDisplayed=n,this.mapOfTreesById=r,this.initializedWithTrees=!1,this.incommingTreesEmptyOnesAndDiscardedCueMixer=i}return n.prototype.swipe=function(t){var n,r,i=this;return n=this.getDiscarded(t),r=this.incommingTreesEmptyOnesAndDiscardedCueMixer.getToLoadAtBackgroundTrees(n,this.incommingListAndCurrentEmptyTrees.emptyTrees),_.each(r,function(e){e!==undefined&&e!==null&&i.alreadyDisplayed.push(e)}),r=_.map(r,function(e){return i.mapOfTreesById[e]}),this.sceneLoader.stackLoadScene(t,r),this.sceneLoader.playAllStackedScenes()},n.prototype.getDiscarded=function(t){var n=[];return t==="both"?(n.push(this.sceneLoader.getTreeDiscardedWhenSwipeLeft()),n.push(this.sceneLoader.getTreeDiscardedWhenSwipeRight())):n=t==="forestSwipeLeft"?[this.sceneLoader.getTreeDiscardedWhenSwipeLeft()]:[this.sceneLoader.getTreeDiscardedWhenSwipeRight()],n},n.prototype.swipeToSpecificTree=function(e){var t,n,r=this,i=[undefined,undefined];return t=this.getDiscarded("both"),_.each(t,function(e){e!==null&&e!==undefined&&r.incommingListAndCurrentEmptyTrees.push(e)}),n=[undefined,e],n=_.map(n,function(e){return r.mapOfTreesById[e]}),this.sceneLoader.stackLoadScene("forestSwipeRight",i),this.sceneLoader.stackLoadScene("forestSwipeLeft",i),this.sceneLoader.stackLoadScene("forestSwipeRight",n),this.sceneLoader.stackLoadScene("forestSwipeLeft",i),this.sceneLoader.playAllStackedScenes()},n.prototype.swipeLeft=function(){return this.swipe("forestSwipeLeft")},n.prototype.swipeRight=function(){return this.swipe("forestSwipeRight")},n.prototype.init=function(t){var n=this,r=t>=1?undefined:this.incommingListAndCurrentEmptyTrees[0]!==undefined?this.incommingListAndCurrentEmptyTrees.shift():-1,i=t>=2?undefined:this.incommingListAndCurrentEmptyTrees[0]!==undefined?this.incommingListAndCurrentEmptyTrees.shift():-1,s=t>=3?undefined:this.incommingListAndCurrentEmptyTrees[0]!==undefined?this.incommingListAndCurrentEmptyTrees.shift():-1,o=new Promise(function(e,t){n.initializedWithTrees=!0,n.resolve=e,n.sceneLoader.loadScene("forestSwipeLeft",[n.mapOfTreesById[r],n.mapOfTreesById[i],undefined,n.mapOfTreesById[s]],n,function(e){e.resolve(),n.alreadyDisplayed.push(s),n.alreadyDisplayed.push(i),n.alreadyDisplayed.push(r)})});return o},n}),define("View/SpriteLevel/SpriteTreeTextSetter",["../../lib/underscore","../../lib/rsvp"],function(e,t){"use strict";function n(e){this.spriteManagerPhaser=e}return n.prototype.setIsTyping=function(t,n){var r=this.spriteManagerPhaser.findTreeSpriteGroupByName(n),i=r.textSetter;t?i.startTyping():i.stopTyping()},n.prototype.addChar=function(t,n){var r=this.spriteManagerPhaser.findTreeSpriteGroupByName(t),i=r.textSetter;return i.addChar(n),i.text},n.prototype.removeChar=function(t){var n=this.spriteManagerPhaser.findTreeSpriteGroupByName(t),r=n.textSetter;return r.removeChar(),r.text},n.prototype.unBury=function(t,n){var r=this.spriteManagerPhaser.findTreeSpriteGroupByName(t),i=r.textSetter;return i.unBury(n),i.text},n}),define("View/SceneLoaderLevel/SceneTreeTextSetter",["../../lib/underscore","../../lib/rsvp","../SpriteLevel/SpriteTreeTextSetter"],function(e,t,n){"use strict";function r(e,t){this.sceneLoader=e,this.spriteTreeTextSetter=t}return r.prototype.setIsTyping=function(t){var n=this.sceneLoader.getTreeWithFinalPosition("1c");this.spriteTreeTextSetter.setIsTyping(t,n.id)},r.prototype.addChar=function(t){var n=this.sceneLoader.getTreeWithFinalPosition("1c"),r=this.spriteTreeTextSetter.addChar(n.id,t);n.tree.text=r},r.prototype.getEditedTreeText=function(){var t=this.sceneLoader.getTreeWithFinalPosition("1c");return t.tree.text},r.prototype.removeChar=function(){var t=this.sceneLoader.getTreeWithFinalPosition("1c"),n=this.spriteTreeTextSetter.removeChar(t.id);t.tree.text=n},r.prototype.unBury=function(t){var n=this.sceneLoader.getTreeWithFinalPosition("1c");this.spriteTreeTextSetter.unBury(n.id,t)},r}),define("View/SpriteLevel/SpriteTreeKmCounterSetter",["../../lib/underscore","../../lib/rsvp"],function(e,t){"use strict";function n(e){this.spriteManagerPhaser=e}return n.prototype.setDistance=function(t,n){var r=this.spriteManagerPhaser.findTreeSpriteGroupByName(t),i=r.kmSetter;r.kmSetter!==undefined&&i.setDistance(n)},n}),define("View/SceneLoaderLevel/SceneTreeKmSetter",["../../lib/underscore","../../lib/rsvp","../SpriteLevel/SpriteTreeKmCounterSetter"],function(e,t,n){"use strict";function r(e,t){this.sceneLoader=e,this.spriteTreeKmSetter=t,this.lastDistance=0}return r.prototype.setDistance=function(t){var n=this.sceneLoader.getTreeWithFinalPosition("1c");if(n===null)return;this.spriteTreeKmSetter.setDistance(n.id,t),this.lastDistance=t,n.tree.meters=t},r.prototype.getLastDistance=function(){return this.lastDistance},r}),define("View/SceneLoaderLevel/SceneTreeCompassSetter",["../../lib/underscore","../../lib/rsvp"],function(e,t){"use strict";function n(e,t){this.sceneLoader=e,this.spriteCompassSetter=t}return n.prototype.setAngle=function(t){var n=this.sceneLoader.getTreeWithFinalPosition("1c");if(n===null)return;this.spriteCompassSetter.setAngle(n.id,t)},n}),define("View/SpriteLevel/SpriteTreeCompassSetter",["../../lib/underscore","../../lib/rsvp"],function(e,t){"use strict";function n(e){this.spriteManagerPhaser=e}return n.prototype.setAngle=function(t,n){var r=this.spriteManagerPhaser.findTreeSpriteGroupByName(t),i=r.compassSetter;i!==undefined&&i.setAngle(n)},n}),define("Controll/RelativeLocationCalculator",["../lib/underscore","../util/CoordinatesCalculator"],function(e,t){"use strict";function n(e,n,r,i){var s=this;this.treeHashIdToTree=e,this.sceneKmSetter=n,this.compassSetter=r,this.gpsMovmentTrigger=i,this.currentTargetCoordinates=undefined,this.currentCellPhoneCoordinates=undefined,this.currentTargetCoordinates={},this.coordinatesCalculator=new t,this.orientationNord=0,window.addEventListener("deviceorientation",function(e){s.orientationNord=e.alpha,s.calculateAndSendCompassOrientationToTreeTip()},!1)}return n.prototype.onNewlyPresentedTree=function(t){var n;if(t===undefined||t<10||t===null)return;n=this.treeHashIdToTree[t],this.currentTargetCoordinates.longitude=n.x,this.currentTargetCoordinates.latitude=n.y,this.calculateAndSendLocationTips()},n.prototype.onNewlyLocationOfTheCellPhone=function(t){this.currentCellPhoneCoordinates=t,this.calculateAndSendLocationTips()},n.prototype.calculateAndSendLocationTips=function(t){if(this.currentCellPhoneCoordinates===undefined)return;this.calculateAndSendMetersToTreeTip(),this.calculateAndSendCompassOrientationToTreeTip()},n.prototype.calculateAndSendMetersToTreeTip=function(){this.metersFromCellPhoneToTargetTree=this.coordinatesCalculator.distanceBetweenCoordinates(this.currentCellPhoneCoordinates,this.currentTargetCoordinates);if(isNaN(this.metersFromCellPhoneToTargetTree))return;this.sceneKmSetter.setDistance(Math.round(this.metersFromCellPhoneToTargetTree)),this.metersFromCellPhoneToTargetTree<130?this.gpsMovmentTrigger.setPrecisionNowIsImportant():this.gpsMovmentTrigger.setPrecisionNowIsNotImportant()},n.prototype.calculateAndSendCompassOrientationToTreeTip=function(){var t=this.coordinatesCalculator.angleWithBetweenCoords(this.currentCellPhoneCoordinates,this.currentTargetCoordinates);t+=this.orientationNord,this.compassSetter.setAngle(t)},n}),define("View/UIEngineView/PasswordDialog",[],function(){"use strict";function s(e){this.initSpriteGroupInPhaserEngine(e),this.createBackground(),this.setNoText(),this.hide()}var e=92,t=100,n=9,r=60,i=11;return s.prototype.initSpriteGroupInPhaserEngine=function(t){this.game=t.game,this.displayGroup=this.game.add.group()},s.prototype.createBackground=function(){this.background=this.displayGroup.create(e,t,"passwordBox")},s.prototype.addTextImage=function(t,n,r){var i=this.game.add.bitmapText(0,0,"ubuntu",r,24);this.textImage=this.displayGroup.create(t,n,i.generateTexture()),i.destroy(),this.textImage.scale.x=.9,this.textImage.scale.y=.9},s.prototype.show=function(){this.displayGroup.setAll("visible",!0),this.displayGroup.setAll("exists",!0)},s.prototype.hide=function(){this.displayGroup.setAll("visible",!1),this.displayGroup.setAll("exisits",!1)},s.prototype.setText=function(s){this.text=s,this.textImage!==undefined&&this.textImage.destroy(),this.addTextImage(e+n,t+r,this.text)},s.prototype.setNoText=function(){this.setText("")},s.prototype.getText=function(){return this.text},s.prototype.addChar=function(t){if(this.text.length>i)return;this.addCharWithoutRestriction(t)},s.prototype.addCharWithoutRestriction=function(t){if(this.text.length>=i)return;this.text+=t,this.setText(this.text)},s.prototype.removeChar=function(){var t=this.text.substring(0,this.text.length-1);this.setText(t)},s.prototype.hideAndSetNoText=function(){this.hide(),this.setNoText()},s}),define("Controll/LeafPileUnburier",["../lib/underscore","../util/CoordinatesCalculator"],function(e,t){"use strict";function r(e,n){this.treeHashIdToTree=e,this.currentTargetCoordinates=undefined,this.currentCellPhoneCoordinates=undefined,this.currentTargetCoordinates={},this.coordinatesCalculator=new t,this.bussinesController=n}var n=14;return r.prototype.onNewlyPresentedTree=function(t){var n;if(t===undefined||t<10||t===null)return;n=this.treeHashIdToTree[t],this.currentTargetCoordinates.longitude=n.x,this.currentTargetCoordinates.latitude=n.y,this.checkIfNeedsToBeUnburied()},r.prototype.onNewlyLocationOfTheCellPhone=function(e){this.currentCellPhoneCoordinates=e,this.checkIfNeedsToBeUnburied()},r.prototype.checkIfNeedsToBeUnburied=function(e){if(this.currentCellPhoneCoordinates===undefined)return;this.calculateMetersAndUnburyIfNecesary()},r.prototype.calculateMetersAndUnburyIfNecesary=function(){this.metersFromCellPhoneToTargetTree=this.coordinatesCalculator.distanceBetweenCoordinates(this.currentCellPhoneCoordinates,this.currentTargetCoordinates),this.metersFromCellPhoneToTargetTree<n&&this.currentCellPhoneCoordinates.accuracy<14&&this.bussinesController.unBuryLayer("leafs")},r}),define("View/UIEngineView/VotingPanel",[],function(){"use strict";function r(e,t){this.bussinesController=t,this.initSpriteGroupInPhaserEngine(e),this.createButtons(t),this.hide()}var e=225,t=550,n=160;return r.prototype.initSpriteGroupInPhaserEngine=function(t){this.game=t.game,this.displayGroup=this.game.add.group()},r.prototype.createButtons=function(r){this.downVote=this.displayGroup.create(e+n,t,"downVote"),this.upVote=this.displayGroup.create(e-n,t,"upVote"),this.setAsButton(this.downVote,r,"downVote"),this.setAsButton(this.upVote,r,"upVote")},r.prototype.setAsButton=function(e,t,n){var r={observer:t,button:e,callbackName:n,panel:this};e.inputEnabled=!0,e.input.priorityID=1,e.useHandCursor=!0,e.events.onInputDown.removeAll(),e.events.onInputDown.add(function(){this.button.inputEnabled=!1,this.button.useHandCursor=!1,this.observer[n](),this.panel.hide()},r)},r.prototype.show=function(){this.displayGroup.setAll("visible",!0),this.displayGroup.setAll("exists",!0),this.setAsButton(this.downVote,this.bussinesController,"downVote"),this.setAsButton(this.upVote,this.bussinesController,"upVote")},r.prototype.hide=function(){this.displayGroup.setAll("visible",!1),this.displayGroup.setAll("exisits",!1)},r}),define("View/UIEngineView/FlowerPanel",[],function(){"use strict";function i(e){this.createGroup(e),this.lastFlowerNumber=0,this.flowerArray=[]}var e=0,t=0,n=458,r=100;return i.prototype.createGroup=function(r){this.game=r.game,this.group=this.game.add.group(),this.group.x=e,this.group.y=t},i.prototype.addNFlowers=function(t,n,r){var i,s,o,u;if(n<0&&this.lastFlowerNumber>=n&&this.lastFlowerNumber>0){this.removeNFlowers(n);return}if(n+this.lastFlowerNumber<=0)return;for(i=0;i<n;i+=1)s=this.lastFlowerNumber+i,o=this.getXYFromNAndId(s,t),u=this.group.create(o.x,o.y,"flower"),this.makeFlowerAppeare(u,r),this.flowerArray.push(u);this.lastFlowerNumber+=n},i.prototype.removeNFlowers=function(t){var n,r;t*=-1;for(n=0;n<t;n+=1)r=this.flowerArray.pop(),r.destroy()},i.prototype.show=function(t,n){this.addNFlowers(t,n)},i.prototype.hide=function(){this.flowerArray=[],this.lastFlowerNumber=0,this.group.destroy(),this.group=this.game.add.group()},i.prototype.getXYFromNAndId=function(e,t){var i,s,o=this.hashCode(e+" "+e+"X sugar "+t),u=this.hashCode(e+" "+e+" Y sugar "+t),a,f=0;o=Math.abs(o),u=Math.abs(u),i=parseInt((""+o).substring(0,3)),s=parseInt((""+u).substring(0,3)),i/=1e3,s/=1e3,i=i*n/2,s=s*r/2,a=Math.abs(e%4);if(a===0)return{x:i,y:s+f};if(a===1)return{x:i+n/2,y:s+f};if(a===2)return{x:i,y:s+r/2+f};if(a===3)return{x:i+n/2,y:s+r/2+f};console.log("shouldnt come here")},i.prototype.hashCode=function(e){var t=0,n,r;if(e.length===0)return t;for(n=0;n<e.length;n+=1)r=e.charCodeAt(n),t=(t<<5)-t+r,t&=t;return t},i.prototype.makeFlowerAppeare=function(e,t){var n=Math.random()*400,r=Math.random()*1100;t!==undefined&&(r=0,n=100),e.alpha=0,e.angle+=Math.random()*360,this.game.add.tween(e).to({alpha:1},n,"Linear",!0,r,0)},i.prototype.makeFlowerDisappeare=function(e){var t=1400,n;n=this.game.add.tween(e).to({alpha:0},t,"Linear",!0,0,0),n.onComplete.add(function(){e.destroy()},this)},i}),define("Controll/MapKmToDistanceUnits",["../lib/underscore"],function(e){"use strict";function t(){}return t.prototype.map=function(e){return e<30?0:e<50?1:e<100?5:e<200?10:e<400?25:e<5e3?Math.round(e/1e3)*2+25:e<1e4?Math.round(Math.round(e/1e3)*.5)+45:Math.round(e/1e4)+13},t}),define("Controll/IncommingTreesEmptyOnesAndDiscardedCueMixer",["lib/underscore","../util/CoordinatesCalculator","./MapKmToDistanceUnits"],function(e,t,n){"use strict";function r(e,r,i){this.incommingList=e,this.mapOfTreesById=r,this.gpsMovmentTrigger=i,this.coordinatesCalculator=new t,this.mapKmToDistanceUnits=new n,this.icommingTreesWithItsUnitList=[],this.exploredDistanceUnitsByWatchingEmptyTrees=0,this.firstUseOfThisClass=!0,this.lastKnownUserLocation={}}return r.prototype.getToLoadAtBackgroundTrees=function(t){var n,r;return t=_.uniq(t),t=t.filter(function(e){return e!==undefined&&e>30}),t.length>0?(n=t.shift(),r=undefined,t.length>0&&(r=t.shift())):(this.ifUserHasMovedResetExploredDistanceUnitsByWatchingEmptyTrees(),this.icommingTreesWithItsUnitList=this.orderIncommingListFromFarToNearAndAddDistanceUnits(this.incommingList),n=this.icommingTreesWithItsUnitListToEmptyTreeOrNotInOrderToStackIt(),r=this.icommingTreesWithItsUnitListToEmptyTreeOrNotInOrderToStackIt()),Math.random()>.5?[n,r]:[r,n]},r.prototype.ifUserHasMovedResetExploredDistanceUnitsByWatchingEmptyTrees=function(){if(this.firstUseOfThisClass){this.lastKnownUserLocation.latitude=this.gpsMovmentTrigger.lastMoveCoordinates.latitude,this.lastKnownUserLocation.longitude=this.gpsMovmentTrigger.lastMoveCoordinates.longitude,this.exploredDistanceUnitsByWatchingEmptyTrees=0,this.firstUseOfThisClass=!1;return}var e=this.coordinatesCalculator.distanceBetweenCoordinates(this.lastKnownUserLocation,this.gpsMovmentTrigger.lastMoveCoordinates);e>30&&(this.exploredDistanceUnitsByWatchingEmptyTrees-=this.mapKmToDistanceUnits.map(e)-1,this.exploredDistanceUnitsByWatchingEmptyTrees<0&&(this.exploredDistanceUnitsByWatchingEmptyTrees=0),this.lastKnownUserLocation.latitude=this.gpsMovmentTrigger.lastMoveCoordinates.latitude,this.lastKnownUserLocation.longitude=this.gpsMovmentTrigger.lastMoveCoordinates.longitude)},r.prototype.orderIncommingListFromFarToNearAndAddDistanceUnits=function(t){var n=this.calculateMetersOfEachTreeFromTheActualPosition(t),r=this;return n=_.map(n,function(e){return{treeId:e.treeId,distanceUnit:r.mapKmToDistanceUnits.map(e.distance),distanceKm:e.distance}}),n},r.prototype.calculateMetersOfEachTreeFromTheActualPosition=function(t){var n=this.gpsMovmentTrigger.lastMoveCoordinates,r=[],i,s,o={};for(i=0;i<t.length;i+=1)s=this.mapOfTreesById[t[i]],o.coordinates={longitude:s.x,latitude:s.y},o.distance=Math.round(this.coordinatesCalculator.distanceBetweenCoordinates(o.coordinates,n)),r.push({treeId:s.id,distance:o.distance});return r.sort(function(e,t){return e.distance-t.distance}),r},r.prototype.icommingTreesWithItsUnitListToEmptyTreeOrNotInOrderToStackIt=function(){var t=this.icommingTreesWithItsUnitList[0],n;return t===undefined?undefined:(n=t.distanceUnit,n-this.exploredDistanceUnitsByWatchingEmptyTrees<1?(this.deleteTreeFromIncommingList(t.treeId),this.icommingTreesWithItsUnitList.shift(),t.treeId):(this.exploredDistanceUnitsByWatchingEmptyTrees+=1,console.log("nearest:"+n+" recorregut:"+this.exploredDistanceUnitsByWatchingEmptyTrees),undefined))},r.prototype.deleteTreeFromIncommingList=function(t){var n=this.incommingList.indexOf(t);this.incommingList.splice(n,1)},r}),define("Controll/InitializatorOfBussinesController",["../InputOutput/GpsMovmentTrigger","../Controll/NearbyTreesFromServerToIncommingTreeList","./TreeLoaderToSceneLoaderFromLists","../Model/TreeRestClient","./FillerOfIncommingListIfItGetsEmpty","../InputOutput/HashChangeTrigger","../View/SceneLoaderLevel/SceneTreeTextSetter","../View/SpriteLevel/SpriteTreeTextSetter","../View/SceneLoaderLevel/SceneTreeKmSetter","../View/SpriteLevel/SpriteTreeKmCounterSetter","../View/SceneLoaderLevel/SceneTreeCompassSetter","../View/SpriteLevel/SpriteTreeCompassSetter","./RelativeLocationCalculator","../View/UIEngineView/PasswordDialog","./LeafPileUnburier","../View/UIEngineView/VotingPanel","../View/UIEngineView/FlowerPanel","./IncommingTreesEmptyOnesAndDiscardedCueMixer","../lib/rsvp"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y){function b(e){this.bussinesController=e}return b.prototype.init=function(t){var r;this.bussinesController.gpsMovmentTrigger=new e(this.bussinesController,t.spriteManagerPhaserApiInterface.phaserGame),this.bussinesController.sceneLoaderInterface=t,this.bussinesController.incommingTreesEmptyOnesAndDiscardedCueMixer=new g(this.bussinesController.incommingList,this.bussinesController.mapOfTreesById,this.bussinesController.gpsMovmentTrigger),this.bussinesController.treeLoaderToSceneLoaderFromLists=new n(this.bussinesController.sceneLoaderInterface,this.bussinesController.incommingList,this.bussinesController.alreadyDisplayed,this.bussinesController.mapOfTreesById,this.bussinesController.incommingTreesEmptyOnesAndDiscardedCueMixer),r=new u(this.bussinesController.sceneLoaderInterface.spriteManagerPhaserApiInterface),this.bussinesController.sceneTreeTextSetterInterface=new o(t,r),r=new f(this.bussinesController.sceneLoaderInterface.spriteManagerPhaserApiInterface),this.bussinesController.sceneTreeTextKmInterface=new a(t,r),r=new c(this.bussinesController.sceneLoaderInterface.spriteManagerPhaserApiInterface),this.bussinesController.sceneTreeCompassInterface=new l(t,r),this.bussinesController.relativeLocationCalculator=new h(this.bussinesController.mapOfTreesById,this.bussinesController.sceneTreeTextKmInterface,this.bussinesController.sceneTreeCompassInterface,this.bussinesController.gpsMovmentTrigger),this.bussinesController.leafPileUnburier=new d(this.bussinesController.mapOfTreesById,this.bussinesController),this.bussinesController.sceneLoaderInterface.newlyPresentedTreeSubjectNotifier.addObserver(this.bussinesController.relativeLocationCalculator),this.bussinesController.sceneLoaderInterface.newlyPresentedTreeSubjectNotifier.addObserver(this.bussinesController.leafPileUnburier),this.bussinesController.gpsMovmentTrigger.init(this.bussinesController.relativeLocationCalculator,this.bussinesController.leafPileUnburier),this.bussinesController.passwordDialog=new p(this.bussinesController.sceneLoaderInterface.spriteManagerPhaserApiInterface.phaserGame),this.bussinesController.votingPanel=new v(this.bussinesController.sceneLoaderInterface.spriteManagerPhaserApiInterface.phaserGame,this.bussinesController),this.bussinesController.flowerPanel=new m(this.bussinesController.sceneLoaderInterface.spriteManagerPhaserApiInterface.phaserGame)},b}),define("View/UIEngineView/IframeDisplayer",[],function(){function e(){}function t(e){var t=document.createElement("script");t.setAttribute("type","text/javascript"),t.src=e,document.body.appendChild(t)}return e.prototype.displayPopUp=function(e){var t=setHtmlContent("popUpContent",e);blockElement("popUp")},e.prototype.showYoutubeVideo=function(t){t=this.sanitizeId(t);var n='<iframe width="100%" src="//www.youtube.com/embed/'+t+'" frameborder="0" allowfullscreen>';this.displayPopUp(n)},e.prototype.showImgurPicture=function(n){var r='<blockquote class="imgur-embed-pub" lang="en" data-id="'+n+'"></blockquote>';this.displayPopUp(r),t("//s.imgur.com/min/embed.js")},e.prototype.sanitizeId=function(t){var n=["&","<",">",'"',"'","`"," ","!","@","$","%","(",")","=","+","{","}","[","]"];for(i=0;i<n.length;i++)t.replace(n[i],"");return t},e}),define("Controll/WelcomeOfUserDinamic",["../lib/underscore","../scenes/Constants"],function(e,t){"use strict";function n(e){this.bussinesController=e}return n.prototype.startWelcomeToUser=function(){this.loadWelcomeTrees(),this.setUpHashes(),this.stackLoadSceneWithWelcomeTreeCorrespondingToTheBrowserLanguage(),this.playWelcomeTrees()},n.prototype.loadWelcomeTrees=function(){console.log("building welcome trees"),this.bussinesController.nearbyTreesFromServerToIncommingTreeList.loadTreeToHash({id:t.specialTreesCodes.es,ip:"87.223.58.75",metersToHide:10,text:"",timestamp:1441013147469,x:this.bussinesController.gpsMovmentTrigger.actualCoordinates.longitude,y:this.bussinesController.gpsMovmentTrigger.actualCoordinates.latitude}),this.bussinesController.nearbyTreesFromServerToIncommingTreeList.loadTreeToHash({id:t.specialTreesCodes.en,ip:"87.223.58.75",metersToHide:10,text:"",timestamp:1441013147469,x:this.bussinesController.gpsMovmentTrigger.actualCoordinates.longitude,y:this.bussinesController.gpsMovmentTrigger.actualCoordinates.latitude}),this.bussinesController.nearbyTreesFromServerToIncommingTreeList.loadTreeToHash({id:t.specialTreesCodes.ca,ip:"87.223.58.75",metersToHide:10,text:"",timestamp:1441013147469,x:this.bussinesController.gpsMovmentTrigger.actualCoordinates.longitude,y:this.bussinesController.gpsMovmentTrigger.actualCoordinates.latitude})},n.prototype.setUpHashes=function(){this.bussinesController.gpsMovmentTrigger.forceUpdate(),this.bussinesController.hashChangeTrigger.storeActualHash()},n.prototype.stackLoadSceneWithWelcomeTreeCorrespondingToTheBrowserLanguage=function(){var e=this.getBrowserLanguageId();this.stackLoadSceneWithWelcomeTreeCorrespondingToTheIdOfTheBrowserLanguage(e)},n.prototype.getBrowserLanguageId=function(){var e=navigator.language||navigator.userLanguage;return t.specialTreesCodes[e]!==undefined?t.specialTreesCodes[e]:t.specialTreesCodes.defaultLanguage},n.prototype.stackLoadSceneWithWelcomeTreeCorrespondingToTheIdOfTheBrowserLanguage=function(e){if(this.bussinesController.mapOfTreesById[e]===undefined)throw"Welcome tree with ID "+e+" is not loaded";this.bussinesController.sceneLoaderInterface.stackLoadScene("forestSwipeLeft",[undefined,this.bussinesController.mapOfTreesById[e],undefined])},n.prototype.playWelcomeTrees=function(){var e=this.bussinesController,n=t;this.bussinesController.updateWithoutMoving().then(function(){e.appHasStarted(),e.incommingList.emptyTrees===0?e.sceneLoaderInterface.stackLoadScene("forestSwipeRight",[undefined,{id:n.specialTreesCodes.fullForest,text:""},undefined]):e.sceneLoaderInterface.stackLoadScene("forestSwipeRight",[undefined,null,undefined]),e.sceneLoaderInterface.playAllStackedScenes().then(function(){e.justDisplayedATree(),e.hashChangeTrigger.triggerIfStoredHashWasNotEmpty(),e.hashChangeTrigger.update()}).catch(function(e){alert("error"),console.log(e.stack)}),e.fillerOfIncommingListIfItGetsEmpty.start()}).catch(function(e){alert("error"),console.log(e.stack)})},n}),define("Controll/UserInterfaceBussinesController",["../Controll/NearbyTreesFromServerToIncommingTreeList","./FillerOfIncommingListIfItGetsEmpty","../InputOutput/HashChangeTrigger","./InitializatorOfBussinesController","../View/UIEngineView/IframeDisplayer","../Controll/WelcomeOfUserDinamic","../Model/TreeRestClient"],function(e,t,n,r,i,s,o){"use strict";function h(){this.state=u,this.incommingList=[],this.incommingList.push=function(e){return(e===null||e===undefined)&&console.log("bug detected"),Array.prototype.push.apply(this,arguments)},this.alreadyDisplayed=[],this.mapOfTreesById={},this.fillerOfIncommingListIfItGetsEmpty=new t(this.incommingList,this),this.nearbyTreesFromServerToIncommingTreeList=new e(this.incommingList,this.alreadyDisplayed,this.mapOfTreesById,this.fillerOfIncommingListIfItGetsEmpty),this.hashChangeTrigger=new n(this)}var u="navigate",a="writting",f="password",l="vid:",c="pic:";h.prototype.init=function(e,t){var n=new r(this),i;this.backgroundMap=t,i=new s(this),n.init(e),i.startWelcomeToUser()},h.prototype.swipeLeft=function(){var t=this;if(this.state===u)return t.justLeftBehindATree(),this.treeLoaderToSceneLoaderFromLists.swipeLeft().then(function(e){console.log("----SL----"),console.log("incomming: "+t.incommingList),console.log("already: "+t.alreadyDisplayed),t.setHashUrlAndIgnoreUpdatingIfNotUndefined(e),t.justDisplayedATree()}).catch(function(e){alert("error"),console.log(e.stack)})},h.prototype.swipeRight=function(){var t=this;if(this.state===u)return t.justLeftBehindATree(),this.treeLoaderToSceneLoaderFromLists.swipeRight().then(function(e){console.log("----SR----"),console.log("incomming: "+t.incommingList),console.log("already: "+t.alreadyDisplayed),t.setHashUrlAndIgnoreUpdatingIfNotUndefined(e),t.justDisplayedATree()}).catch(function(e){alert("error"),console.log(e.stack)})},h.prototype.linkClicked=function(e){var t=new i;if(p(e)){this.hashChangeTrigger.setHashAtUrlAndStartUpdatingProcess(e);return}if(d(e,l)){t.showYoutubeVideo(e.substr(l.length));return}if(d(e,c)){t.showImgurPicture(e.substr(c.length));return}alert("Hashtags are still not enabled, but use them so they'll be useful in the future")},h.prototype.setHashUrlAndIgnoreUpdatingIfNotUndefined=function(e){e!==undefined&&e!==3?this.hashChangeTrigger.setHashAtUrlAndIgnoreUpdatingProcess(e):this.hashChangeTrigger.removeHash()},h.prototype.upVote=function(){var e;this.voteEmmited(this.getTreeAlreadyDisplayed().id,1),e=this.sceneLoaderInterface.spriteManagerPhaserApiInterface.phaserGame.game.add.audio("bell"),e.play()},h.prototype.downVote=function(){var e;this.voteEmmited(this.getTreeAlreadyDisplayed().id,-1),e=this.sceneLoaderInterface.spriteManagerPhaserApiInterface.phaserGame.game.add.audio("unbell"),e.play()},h.prototype.voteEmmited=function(e,t){var n=new o,r=this;n.getSpecificTree(e).then(function(e){return e.treeContent.metersToHide+=t,n.put(e.treeContent)}).then(function(n){var i=r.getTreeAlreadyDisplayed();i!==undefined&&e!==3&&r.flowerPanel.addNFlowers(i.id,t,"inmediately")}).catch(function(e){alert("error in connection voting tree: "+e),console.log(e.stack)})},h.prototype.clickedOnWriteButton=function(){this.state===u&&(this.state=a,this.keyboardInterface.showOnScene(),this.sceneTreeTextSetterInterface.setIsTyping(!0))},h.prototype.putTreeOnServer=function(){var e=this.sceneTreeTextSetterInterface.getEditedTreeText(),t=this.gpsMovmentTrigger.actualCoordinates,n=new o,r={text:e,metersToHide:0,x:t.longitude,y:t.latitude},i=this;return new Promise(function(e,t){return i.gpsMovmentTrigger.precisionOneToTen!==10&&t("not enought precision"),n.put(r).then(function(e){return e.treeContent===null&&t("error posting tree, this place might be full"),e}).then(function(t){i.hashChangeTrigger.setHashAtUrlAndIgnoreUpdatingProcess(t.treeContent.id),i.gpsMovmentTrigger.forceUpdate(),i.nearbyTreesFromServerToIncommingTreeList.loadSpecificTreeToHash(t.treeContent.id).then(function(){i.incommingList.push(t.treeContent.id),e()})})})},h.prototype.clickedOnKey=function(t){var n=this;this.state===a?t==="ok"?this.putTreeOnServer().then(function(){n.state=u,n.keyboardInterface.hideOnScene(),n.sceneTreeTextSetterInterface.setIsTyping(!1),n.gpsMovmentTrigger.setPrecisionNowIsNotImportant()}).catch(function(e){alert(e),n.state=u,n.keyboardInterface.hideOnScene(),n.sceneTreeTextSetterInterface.setIsTyping(!1),n.gpsMovmentTrigger.setPrecisionNowIsNotImportant()}):t==="cancel"?(this.state=u,this.keyboardInterface.hideOnScene(),this.sceneTreeTextSetterInterface.setIsTyping(!1)):t==="backwards"?this.sceneTreeTextSetterInterface.removeChar():this.sceneTreeTextSetterInterface.addChar(t):this.state===f&&(t==="ok"?(this.passwordDialog.getText()===this.getPasswordFromLockedTree()&&this.unBuryLayer("lock"),this.passwordDialog.hideAndSetNoText(),this.keyboardInterface.hideOnScene(),this.state=u):t==="cancel"?(this.passwordDialog.hideAndSetNoText(),this.keyboardInterface.hideOnScene(),this.state=u):t==="backwards"?this.passwordDialog.removeChar():this.passwordDialog.addChar(t))},h.prototype.unBuryLayer=function(e){var t=this.getTreeAlreadyDisplayed();this.sceneTreeTextSetterInterface.unBury(e),t.unburiedLayersTreeLevel===undefined&&(t.unburiedLayersTreeLevel={}),t.unburiedLayersTreeLevel[e]=!0},h.prototype.getPasswordFromLockedTree=function(){var t=this.getTreeAlreadyDisplayed(),n,r,i,s=t.text.replace("\n","");return r=s.substring(s.indexOf("*passwd:")+"*passwd:".length,s.length),i=r.indexOf(" "),i!==-1?n=r.substring(0,i):n=r,n=this.firstNcharcters(n,11),console.log("pwd:"+n),n},h.prototype.justDisplayedATree=function(){var e=this.getTreeAlreadyDisplayed();e!==undefined&&e!==null&&(e.id>30&&(this.votingPanel.show(),this.flowerPanel.addNFlowers(e.id,e.metersToHide)),this.backgroundMap.justDisplayedATreeSoDisplayAMap(e)),e===null&&this.gpsMovmentTrigger.setPrecisionNowIsImportant()},h.prototype.justLeftBehindATree=function(){this.votingPanel.hide(),this.flowerPanel.hide(),this.backgroundMap.hideMap()},h.prototype.getTreeAlreadyDisplayed=function(){var t=this.sceneLoaderInterface.getTreeAlreadyDisplayed(),n;return t===null?null:(n=this.mapOfTreesById[t],n)},h.prototype.userHasMoved=function(t){return this.nearbyTreesFromServerToIncommingTreeList.userHasMovedTo(this.gpsMovmentTrigger.actualCoordinates)},h.prototype.updateWithoutMoving=function(){return this.userHasMoved(undefined)},h.prototype.hashHasBeenUpdated=function(e){var t=this;if(isNaN(e)||e==="")return;this.nearbyTreesFromServerToIncommingTreeList.loadSpecificTreeToHash(e).then(function(){t.treeLoaderToSceneLoaderFromLists.swipeToSpecificTree(e).then(function(){t.justDisplayedATree()}).catch(function(e){alert("error"),console.log(e.stack)})}).catch(function(e){alert("error"),console.log(e.stack)})},h.prototype.firstNcharcters=function(t,n){return t.length<n?t:t.substr(0,n)},h.prototype.buriedLayerEvent=function(e){e==="lock"&&(this.passwordDialog.show(),this.state=f,this.keyboardInterface.showOnScene())},h.prototype.handleIgnoredPrecision=function(e){if(e<10){this.notPreciseAndIgnoredAlert.showNotPrecise();return}this.notPreciseAndIgnoredAlert.hideNotPrecise()},h.prototype.forceHandlePrecisionAlerts=function(){this.gpsMovmentTrigger.forceHandlePrecisionAlerts()},h.prototype.appHasStarted=function(){this.sceneLoaderInterface.spriteManagerPhaserApiInterface.phaserGame.removeWelcomeScreen()};var p=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},d=function(e,t){return e.indexOf(t)===0};return h}),define("scenes/KeyboardDescriptor",[],function(){"use strict";var e=640,t=480,n=280,r=30,i=5,s=5,o=5;return{yinit:n,width:10.5*(r+s),height:4*(r+o),keySize:r,margin:i,distanceBetweenKeys:r+s,distanceBetweenLines:r+5,fontSize:20,scale:1.29,keysOccupiedBySpace:4,keysOccupiedByEnter:3,keysOccupiedByFeaturesKeys:5,popupDistance:r+30,mayusqKeys:[["Q","W","E","R","T","Y","U","I","O","P"],["A","S","D","F","G","H","J","K","L","Ñ"],["Z","X","C","V","B","N","M"]],specialKeys:[[",","!","?",".","/","\\","(",")","_","-"],["[","]","{","}",":","|","'","`","=",'"'],["+","^","#","0","1","2","3"]],numberKeys:[["0","1","2","3","4","5","6","7","8","9"],["-","_","?","!",":",",","'",".","=",";"],["+","&","*","$","#","@","€"]],keys:[["q","w","e","r","t","y","u","i","o","p"],["a","s","d","f","g","h","j","k","l","ñ"],["z","x","c","v","b","n","m"]],featuresKeyboard:{keyboardKeys:[["Lock: ","Bury: "],["Tweet: ","Link: "],["Video: ","Picture: "],[undefined,undefined]],keyboardMap:[["*passwd:","*bury "],["@","#"],["#vid:","#pic:"],[undefined,undefined]],keyboardIcons:[["lockBg","buryBg"],["twitterBg","linkBg"],["heartBg","catBg"],["heartBg",undefined]]},acsiiArtKeyboard:{keyboardKeys:[["Heart: ","Cat: "],["Video: ",undefined],["Lock: ","Bury: "],["Tweet: ","Link: "]],keyboardMap:[["	    __  __         /  V   \\        \\     /          \\   /            \\/         ","	    /\\___/\\         \\ -.- /          `-.^.-'          /\"\\       "],["*passwd:","*bury "],["@","#"],["*video",undefined]],keyboardIcons:[["lockBg","buryBg"],["twitterBg","linkBg"],["heartBg","catBg"],["heartBg",undefined]]}}}),define("View/UIEngineView/Keyboard",["../../scenes/KeyboardDescriptor"],function(e){"use strict";function a(e,n){this.game=e.game,this.phaserGame=e,this.gestureObserver=n,this.state=t,this.buildKeyboardFromState(),this.hideAndDisable()}var t="letters",n="mayusq",r="features",i="symbols",s="numbers",o="switch",u="asciiart";return a.prototype.buildKeyboardFromState=function(){this.keyboardGroup!==undefined&&this.keyboardGroup.destroy(),this.keyboardGroup=this.game.add.group(),this.setSizeAndPositionToKeyboardAcordingToScreenResolution(),this.addCharacters()},a.prototype.setSizeAndPositionToKeyboardAcordingToScreenResolution=function(){this.keyboardGroup.x=0+e.margin,this.keyboardGroup.y=this.phaserGame.coordY(e.yinit),this.keyboardGroup.scale.x=e.scale,this.keyboardGroup.scale.y=e.scale},a.prototype.addCharacters=function(){var t=0,o=0,a,f,l=e.keys;if(this.state===r){this.addFeaturesCharacters(e.featuresKeyboard),a=this.calculatePosition(3,4+e.keysOccupiedBySpace,!1),this.createSwitchKeyboard(a);return}if(this.state===u){this.addFeaturesCharacters(e.acsiiArtKeyboard),a=this.calculatePosition(3,4+e.keysOccupiedBySpace,!1),this.createSwitchKeyboard(a);return}this.state===i&&(l=e.specialKeys),this.state===s&&(l=e.numberKeys),this.state===n&&(l=e.mayusqKeys);for(t=0;t<l.length;t+=1)for(o=0;o<l[t].length;o+=1)f=l[t][o],a=this.calculatePosition(t,o,!0),this.createChar(a,f);a=this.calculatePosition(t-1,o,!0),this.createBackwards(a),a=this.calculatePosition(t,0,!1),this.createEnter(a),a=this.calculatePosition(t,2,!1),this.createSpace(a),a=this.calculatePosition(t,2+e.keysOccupiedBySpace,!1),this.createCancel(a),a=this.calculatePosition(t,4+e.keysOccupiedBySpace,!1),this.createSwitchKeyboard(a)},a.prototype.addFeaturesCharacters=function(e){var t,n;for(n=0;n<4;n+=1)for(t=0;t<2;t+=1)this.findPostionAndCreateFeatureButton(t,n,e)},a.prototype.findPostionAndCreateFeatureButton=function(t,n,r){var i=this.calculatePosition(n,1+t*e.keysOccupiedByFeaturesKeys,!1);this.createFeatureButton(i,r.keyboardKeys[n][t],r.keyboardMap[n][t],r.keyboardIcons[n][t])},a.prototype.createFeatureButton=function(e,t,n,r){var i=this.addKeyBackground(e,n,r);this.addKeyChar(t,i,.1,this.keyboardGroup)},a.prototype.createChar=function(e,t){var n=this.addKeyBackground(e,t,"keyBackground");this.addKeyChar(t,n,.2,this.keyboardGroup)},a.prototype.addKeyBackground=function(t,n,r){var i=this.keyboardGroup.create(t.x,t.y,r),s={observer:this.gestureObserver,sprite:i,game:this.game,character:n,popupDistance:e.popupDistance,keyboardGroup:this.keyboardGroup,backgroundSprite:r,keyboard:this};return i.events.onInputDown.add(function(){navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,navigator.vibrate&&navigator.vibrate(100),this.keyboard.createPopupGroup(this),this.keyboard.createPopupBackgroundSprite(this,75,200,75),this.sprite.hasCharacterWrittenOnImage!==undefined&&this.keyboard.createPopupCharSprite(this,75,200,75),this.character===o?(this.keyboard.nextKeyboardState(),this.keyboard.buildKeyboardFromState()):this.observer.clickedOnKey(this.character)},s),i.alive=!0,this.setSpriteToClickableOrNot(i,!0),i},a.prototype.setSpriteToClickableOrNot=function(t,n){t.inputEnabled=n,n&&(t.input.priorityID=54)},a.prototype.addKeyChar=function(t,n,r,i){var s=this.game.add.bitmapText(4,60,"ubuntu",t,24),o=i.create(0,0,s.generateTexture());return s.destroy(),o.scale.x=.9,o.scale.y=.9,o.x=n.x+n.width/2,o.y=n.y+n.height/2,o.alive=!1,o.anchor.set(.5),n.hasCharacterWrittenOnImage=!0,o},a.prototype.nextKeyboardState=function(){this.state===t?this.state=n:this.state===n?this.state=s:this.state===s?this.state=r:this.state===r?this.state=i:this.state===i?this.state=u:this.state===u&&(this.state=t)},a.prototype.createPopupGroup=function(t){t.popupGroup=this.game.add.group(),t.popupGroup.x=this.keyboardGroup.x,t.popupGroup.y=this.keyboardGroup.y},a.prototype.createPopupBackgroundSprite=function(t,n,r,i){t.newsprite=t.popupGroup.create(t.sprite.x,t.sprite.y-t.popupDistance,t.backgroundSprite),t.newsprite.alpha=1,t.newsprite.scale.x=t.newsprite.scale.y=1.8,t.newsprite.z=40;var s=t.game.add.tween(t.newsprite).to({alpha:1},n,"Linear",!1,0,0),o=t.game.add.tween(t.newsprite).to({alpha:1},r,"Linear",!1,0,0),u=t.game.add.tween(t.newsprite).to({alpha:0},i,"Linear",!1,0,0);s.chain(o),o.chain(u),u.onComplete.add(function(){this.destroy()},t.newsprite),s.start()},a.prototype.createPopupCharSprite=function(t,n,r,i){var s=t.keyboard.addKeyChar(t.character,t.newsprite,.3,t.popupGroup);s.z=50;var o=t.game.add.tween(s).to({alpha:1},n,"Linear",!1,0,0),u=t.game.add.tween(s).to({alpha:1},r,"Linear",!1,0,0),a=t.game.add.tween(s).to({alpha:0},i,"Linear",!1,0,0);o.chain(u),u.chain(a),a.onComplete.add(function(){this.destroy()},s),o.start()},a.prototype.calculatePosition=function(t,n,r){var i=r?t*15:15,s=e.distanceBetweenKeys*n+i,o=e.distanceBetweenLines*t;return{x:s,y:o}},a.prototype.createBackwards=function(e){this.addKeyBackground(e,"backwards","keyBackwards")},a.prototype.createSpace=function(e){this.addKeyBackground(e," ","keySpace")},a.prototype.createEnter=function(e){this.addKeyBackground(e,"ok","keyOk")},a.prototype.createCancel=function(e){this.addKeyBackground(e,"cancel","keyCancel")},a.prototype.createSwitchKeyboard=function(e){this.addKeyBackground(e,o,"keySwitchKeyboard")},a.prototype.showOnScene=function(){this.showAndEnable(),this.keyboardGroup.parent.bringToTop(this.keyboardGroup),this.keyboardGroup.alpha=0,this.game.add.tween(this.keyboardGroup).to({alpha:1},400,"Linear",!0,0,0)},a.prototype.hideOnScene=function(){var e=this.game.add.tween(this.keyboardGroup).to({alpha:0},400,"Linear",!0,0,0);e.onComplete.add(function(){this.hideAndDisable()},this)},a.prototype.hideAndDisable=function(){this.keyboardGroup.alpha=0,this.keyboardGroup.setAll("visible",!1),this.keyboardGroup.setAll("exists",!1),this.keyboardGroup.setAll("inputEnabled",!1),this.keyboardGroup.setAll("useHandCursor",!1)},a.prototype.showAndEnable=function(){this.buildKeyboardFromState(),this.keyboardGroup.setAll("visible",!0),this.keyboardGroup.setAll("exists",!0),this.keyboardGroup.forEachAlive(function(e){e.inputEnabled=!0}),this.keyboardGroup.forEachAlive(function(e){e.useHandCursor=!0})},a}),define("Controll/NewlyPresentedTreeSubjectNotifier",["../lib/underscore"],function(e){"use strict";function t(){this.observers=[]}return t.prototype.addObserver=function(t){if(typeof t.onNewlyPresentedTree!="function"){console.log("truing to subscribe observer to a subject when observer has not the update function");return}this.observers.push(t)},t.prototype.newlyPresentedTree=function(t){var n,r;for(r in this.observers)n=this.observers[r],typeof n.onNewlyPresentedTree!="function"?console.log("observer has not the update function"):n.onNewlyPresentedTree(t)},t}),define("View/UIEngineView/BackgroundMap",[],function(){function n(n){this.game=n.game,this.alphaLayerGroupBg=this.game.add.group(),this.alphaLayerGroupBg.create(e,t,"alphalayerbg"),this.mapGroup=this.game.add.group(),this.alphaLayerGroup=this.game.add.group(),this.alphaLayerSprite=this.alphaLayerGroup.create(e,t,"alphalayer"),this.alphaLayerSprite.alpha=.5,this.mapGroupSpriteImage=this.game.add.image(0,-1500,"map"),this.tex=this.game.add.renderTexture(this.mapGroupSpriteImage.width,this.mapGroupSpriteImage.height,"name",!0),this.mapGroupSprite=this.mapGroup.create(e,t,this.tex)}var e=0,t=340;return n.prototype.justDisplayedATreeSoDisplayAMap=function(n){var r="https://maps.googleapis.com/maps/api/staticmap?center="+n.y+","+n.x+"&zoom=15&size=500x300&maptype=roadmap&key=AIzaSyARLL06eu1X3HSK4HpwHGFVbQDuOPWekh8";this.dynamicLoadImage(this.game,e,t,r,"dinmap",undefined)},n.prototype.displayMap=function(){this.tex.renderXY(this.mapGroupSpriteImage,0,0,!0),this.mapGroup.alpha=0,this.game.add.tween(this.mapGroup).to({alpha:1},400,"Linear",!0,0,0)},n.prototype.hideMap=function(){if(this.mapGroupSprite===undefined)return;this.game.add.tween(this.mapGroup).to({alpha:0},400,"Linear",!0,0,0)},n.prototype._fileComplete=function(e,t,n,r,i){n&&(this.mapGroupSpriteImage.loadTexture(t),this.displayMap())},n.prototype.dynamicLoadImage=function(e,t,n,r,i,s){typeof s=="undefined"&&(s="dynamicLoad_"+r);var o=new Phaser.Loader(e);o.image(s,r),o.onFileComplete.addOnce(this._fileComplete,this),o.start();return},n}),define("View/UIEngineView/NotPreciseAlert",[],function(){function n(n){this.game=n.game,this.alphaLayer=this.game.add.group(),this.alphaLayer.name="notPreciseAlert",this.yesPrecise=this.alphaLayer.create(e,t,"yesPreciseAlert"),this.notPrecise=this.alphaLayer.create(e,t,"notPreciseAlert"),this.yesPrecise.scale.x=this.yesPrecise.scale.y=this.notPrecise.scale.x=this.notPrecise.scale.y=2.2,this.hideNotPrecise()}var e=110,t=500;return n.prototype.showNotPrecise=function(){this.alphaLayer.alpha=.2,this.game.add.tween(this.notPrecise).to({alpha:1},100,"Linear",!0),this.game.add.tween(this.yesPrecise).to({alpha:0},100,"Linear",!0),this.initialTween=this.game.add.tween(this.alphaLayer).to({alpha:.3},1200,"Linear",!0,0,-1),this.initialTween.yoyo(!0,0),this.lastUpdateWasToHideNotPrecise=!1},n.prototype.hideNotPrecise=function(){if(this.lastUpdateWasToHideNotPrecise)return;this.game.add.tween(this.notPrecise).to({alpha:0},100,"Linear",!0),this.game.add.tween(this.yesPrecise).to({alpha:1},100,"Linear",!0);if(this.initialTween){this.initialTween.stop();var e=this.game.add.tween(this.alphaLayer).to({alpha:.3},800,"Linear"),t=this.game.add.tween(this.alphaLayer).to({alpha:0},400,"Linear");e.chain(t),e.start()}else this.alphaLayer.alpha=0;this.lastUpdateWasToHideNotPrecise=!0},n});var phaserGameGlobal=undefined,bussinesControllerGlobal="notitint";require(["View/SceneLoaderLevel/SceneLoader","View/SpriteLevel/SpriteManagerPhaserApi","View/UIEngineView/UiCore/PhaserGame","InputOutput/GestureObserver","Controll/UserInterfaceBussinesController","View/UIEngineView/Keyboard","Controll/NewlyPresentedTreeSubjectNotifier","View/UIEngineView/PasswordDialog","View/UIEngineView/BackgroundMap","View/UIEngineView/NotPreciseAlert"],function(e,t,n,r,i,s,o,u,a,f){"use strict";var l=1e3,c={},h=function(){var l,c,h,p,d=new i,v=new r(d),m=new o,g=new n(function(n){return p=new a(g),h=new s(g,v),d.keyboardInterface=h,c=new t(g,v),l=new e(c,m),c.sceneLoaderInterface=l,d.init(l,p),d.notPreciseAndIgnoredAlert=new f(g),l},v);phaserGameGlobal=g,bussinesControllerGlobal=d};c.tryit=function(){alert("went wrong")},c.tryit=function(){if(longitude!==undefined&&longitude!==40){h();return}setTimeout(c.tryit,l)},c.tryit()}),define("main",function(){});